<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Поиск туров - Bunyod-Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
        }
        
        .search-hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 60px 0 40px;
            color: white;
        }
        
        .search-box {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            margin-top: -40px;
        }
        
        .search-input-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .search-field {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        
        .search-field input, .search-field select {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        .search-field input:focus, .search-field select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .search-field i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
        
        .filter-sidebar {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .filter-section {
            padding: 20px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .filter-section:last-child {
            border-bottom: none;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: #111827;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            padding: 8px 0;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .filter-option:hover {
            color: #667eea;
        }
        
        .filter-option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .filter-option label {
            cursor: pointer;
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .filter-count {
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #6b7280;
        }
        
        .tour-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            margin-bottom: 20px;
        }
        
        .tour-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }
        
        .tour-image {
            width: 280px;
            height: 200px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .tour-content {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .tour-badges {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-popular {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge-new {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .tour-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .tour-location {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 12px;
        }
        
        .tour-features {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #6b7280;
        }
        
        .tour-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .rating-stars {
            color: #fbbf24;
        }
        
        .rating-text {
            font-weight: 600;
            color: #111827;
        }
        
        .rating-count {
            color: #6b7280;
            font-size: 14px;
        }
        
        .tour-price-section {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tour-price {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }
        
        .price-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        .price-amount {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
        }
        
        .btn-book {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .btn-book:hover {
            background: #5a67d8;
        }
        
        .sort-bar {
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .view-toggle {
            display: flex;
            gap: 8px;
        }
        
        .view-btn {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .calendar-widget {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .date-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 12px;
        }
        
        .date-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
            font-size: 12px;
        }
        
        .date-cell:hover {
            background: #f3f4f6;
        }
        
        .date-cell.available {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }
        
        .date-cell.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .date-price {
            font-size: 10px;
            margin-top: 2px;
        }
        
        .price-slider {
            margin-top: 12px;
        }
        
        .price-slider input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }
        
        .price-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .price-inputs {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }
        
        .price-inputs input {
            flex: 1;
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .mobile-filter-btn {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .search-hero {
                padding: 40px 0 30px;
            }
            
            .filter-sidebar {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
                overflow-y: auto;
                border-radius: 0;
            }
            
            .filter-sidebar.active {
                display: block;
            }
            
            .mobile-filter-btn {
                display: block;
            }
            
            .tour-card {
                flex-direction: column;
            }
            
            .tour-image {
                width: 100%;
                height: 200px;
            }
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading-spinner.active {
            display: block;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .no-results i {
            font-size: 48px;
            color: #d1d5db;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white shadow-sm border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <a href="index.html" class="text-2xl font-bold text-gray-800">Bunyod-Tour</a>
                <nav class="hidden md:flex gap-6">
                    <a href="#" class="text-gray-600 hover:text-gray-900">Туры</a>
                    <a href="#" class="text-gray-600 hover:text-gray-900">Отели</a>
                    <a href="#" class="text-gray-600 hover:text-gray-900">Гиды</a>
                    <a href="#" class="text-gray-600 hover:text-gray-900">О нас</a>
                    <a href="#" class="text-gray-600 hover:text-gray-900">Контакты</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Search Hero -->
    <div class="search-hero">
        <div class="max-w-7xl mx-auto px-4">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-4">
                Найдите идеальный тур по Центральной Азии
            </h1>
            <p class="text-center text-white/80 mb-8">
                Более 500 туров по Таджикистану, Узбекистану, Казахстану и другим странам
            </p>
        </div>
    </div>

    <!-- Search Box -->
    <div class="max-w-7xl mx-auto px-4">
        <div class="search-box">
            <div class="search-input-group">
                <div class="search-field" style="flex: 2;">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Куда вы хотите поехать?">
                </div>
                
                <div class="search-field">
                    <i class="fas fa-calendar"></i>
                    <input type="text" id="dateInput" placeholder="Выберите дату">
                </div>
                
                <div class="search-field">
                    <i class="fas fa-users"></i>
                    <select id="guestsInput">
                        <option value="1">1 человек</option>
                        <option value="2">2 человека</option>
                        <option value="3">3 человека</option>
                        <option value="4">4 человека</option>
                        <option value="5+">5+ человек</option>
                    </select>
                </div>
                
                <button class="btn-book" style="padding: 12px 32px;" onclick="searchTours()">
                    <i class="fas fa-search mr-2"></i>
                    Найти
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Filter Sidebar -->
            <aside class="filter-sidebar" id="filterSidebar">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Фильтры</h3>
                    <button class="text-sm text-blue-600 hover:text-blue-800" onclick="resetFilters()">
                        Сбросить все
                    </button>
                </div>

                <!-- Calendar Widget -->
                <div class="filter-section">
                    <h4 class="filter-title">Календарь доступности</h4>
                    <div class="calendar-widget">
                        <div class="flex justify-between items-center mb-3">
                            <button onclick="changeMonth(-1)">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span id="currentMonth" class="font-semibold">Август 2025</span>
                            <button onclick="changeMonth(1)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="date-grid" id="dateGrid">
                            <!-- Calendar dates will be generated here -->
                        </div>
                    </div>
                </div>

                <!-- Price Range -->
                <div class="filter-section">
                    <h4 class="filter-title">Цена</h4>
                    <div class="price-slider">
                        <input type="range" id="priceRange" min="0" max="5000" value="5000" oninput="updatePriceDisplay()">
                    </div>
                    <div class="price-inputs">
                        <input type="number" id="minPrice" placeholder="От" value="0">
                        <input type="number" id="maxPrice" placeholder="До" value="5000">
                    </div>
                </div>

                <!-- Countries -->
                <div class="filter-section">
                    <h4 class="filter-title">Страны</h4>
                    <div class="filter-option">
                        <input type="checkbox" id="country1" checked>
                        <label for="country1">
                            Таджикистан
                            <span class="filter-count">156</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="country2">
                        <label for="country2">
                            Узбекистан
                            <span class="filter-count">89</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="country3">
                        <label for="country3">
                            Казахстан
                            <span class="filter-count">67</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="country4">
                        <label for="country4">
                            Кыргызстан
                            <span class="filter-count">45</span>
                        </label>
                    </div>
                </div>

                <!-- Tour Types -->
                <div class="filter-section">
                    <h4 class="filter-title">Вид тура</h4>
                    <div class="filter-option">
                        <input type="checkbox" id="type1">
                        <label for="type1">
                            Персональный
                            <span class="filter-count">89</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="type2" checked>
                        <label for="type2">
                            Групповой
                            <span class="filter-count">124</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="type3">
                        <label for="type3">
                            VIP
                            <span class="filter-count">23</span>
                        </label>
                    </div>
                </div>

                <!-- Categories -->
                <div class="filter-section">
                    <h4 class="filter-title">Категории</h4>
                    <div class="filter-option">
                        <input type="checkbox" id="cat1">
                        <label for="cat1">
                            Городские туры
                            <span class="filter-count">45</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="cat2">
                        <label for="cat2">
                            Природа/экологические
                            <span class="filter-count">67</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="cat3">
                        <label for="cat3">
                            Исторические
                            <span class="filter-count">38</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="cat4">
                        <label for="cat4">
                            Походы/трекинги
                            <span class="filter-count">52</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="cat5">
                        <label for="cat5">
                            Гастрономические
                            <span class="filter-count">29</span>
                        </label>
                    </div>
                </div>

                <!-- Duration -->
                <div class="filter-section">
                    <h4 class="filter-title">Длительность</h4>
                    <div class="filter-option">
                        <input type="checkbox" id="dur1">
                        <label for="dur1">
                            1-3 дня
                            <span class="filter-count">78</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="dur2">
                        <label for="dur2">
                            4-7 дней
                            <span class="filter-count">156</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="dur3">
                        <label for="dur3">
                            8-14 дней
                            <span class="filter-count">89</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="dur4">
                        <label for="dur4">
                            15+ дней
                            <span class="filter-count">34</span>
                        </label>
                    </div>
                </div>

                <!-- Rating -->
                <div class="filter-section">
                    <h4 class="filter-title">Рейтинг</h4>
                    <div class="filter-option">
                        <input type="checkbox" id="rating5">
                        <label for="rating5">
                            <span class="rating-stars">★★★★★</span>
                            <span class="filter-count">234</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="rating4">
                        <label for="rating4">
                            <span class="rating-stars">★★★★☆</span>
                            <span class="filter-count">156</span>
                        </label>
                    </div>
                    <div class="filter-option">
                        <input type="checkbox" id="rating3">
                        <label for="rating3">
                            <span class="rating-stars">★★★☆☆</span>
                            <span class="filter-count">67</span>
                        </label>
                    </div>
                </div>
            </aside>

            <!-- Tours List -->
            <div class="lg:col-span-3">
                <!-- Sort Bar -->
                <div class="sort-bar">
                    <div class="flex items-center gap-4">
                        <span class="text-gray-600">Найдено: <strong id="resultsCount">156</strong> туров</span>
                        <select class="px-3 py-2 border border-gray-300 rounded-lg" onchange="sortTours(this.value)">
                            <option value="recommended">Рекомендуемые</option>
                            <option value="price-low">Цена: по возрастанию</option>
                            <option value="price-high">Цена: по убыванию</option>
                            <option value="rating">По рейтингу</option>
                            <option value="duration">По длительности</option>
                        </select>
                    </div>
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="setView('list')">
                            <i class="fas fa-list"></i>
                        </button>
                        <button class="view-btn" onclick="setView('grid')">
                            <i class="fas fa-th"></i>
                        </button>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner" id="loadingSpinner">
                    <i class="fas fa-spinner fa-spin text-4xl text-gray-400"></i>
                    <p class="mt-4 text-gray-600">Загрузка туров...</p>
                </div>

                <!-- Tours Container -->
                <div id="toursContainer">
                    <!-- Tour cards will be loaded here -->
                </div>

                <!-- No Results -->
                <div class="no-results" id="noResults" style="display: none;">
                    <i class="fas fa-search"></i>
                    <h3 class="text-xl font-semibold mt-4">Туры не найдены</h3>
                    <p class="mt-2">Попробуйте изменить параметры поиска или фильтры</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Filter Button -->
    <button class="mobile-filter-btn" onclick="toggleMobileFilters()">
        <i class="fas fa-filter mr-2"></i>
        Фильтры
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Initialize date picker
        flatpickr("#dateInput", {
            mode: "single",
            dateFormat: "d.m.Y",
            minDate: "today",
            locale: {
                firstDayOfWeek: 1,
                weekdays: {
                    shorthand: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
                    longhand: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'],
                },
                months: {
                    shorthand: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
                    longhand: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                },
            }
        });

        // Sample tours data
        const sampleTours = [
            {
                id: 1,
                title: "Памирский тракт - Крыша мира",
                location: "Таджикистан, Хорог",
                duration: "7 дней",
                price: 1200,
                rating: 4.8,
                reviews: 234,
                image: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400",
                badges: ["Популярный"],
                features: ["Трансфер", "Гид", "Питание"],
                description: "Незабываемое путешествие по высокогорному Памиру"
            },
            {
                id: 2,
                title: "Жемчужины Самарканда и Бухары",
                location: "Узбекистан, Самарканд",
                duration: "5 дней",
                price: 890,
                rating: 4.9,
                reviews: 189,
                image: "https://images.unsplash.com/photo-1553391264-31d20a22ad50?w=400",
                badges: ["Новый"],
                features: ["Авиа", "Отель 4*", "Завтраки"],
                description: "Путешествие по древним городам Шелкового пути"
            },
            {
                id: 3,
                title: "Чарынский каньон и озеро Кольсай",
                location: "Казахстан, Алматы",
                duration: "3 дня",
                price: 450,
                rating: 4.7,
                reviews: 156,
                image: "https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=400",
                badges: [],
                features: ["Трансфер", "Кемпинг", "Гид"],
                description: "Природные чудеса Казахстана"
            },
            {
                id: 4,
                title: "Иссык-Куль - жемчужина Тянь-Шаня",
                location: "Кыргызстан, Чолпон-Ата",
                duration: "4 дня",
                price: 680,
                rating: 4.6,
                reviews: 98,
                image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400",
                badges: ["Популярный"],
                features: ["Отель", "Пляж", "СПА"],
                description: "Отдых на берегу горного озера"
            },
            {
                id: 5,
                title: "Фанские горы - треккинг к озерам",
                location: "Таджикистан, Пенджикент",
                duration: "10 дней",
                price: 1450,
                rating: 4.9,
                reviews: 67,
                image: "https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=400",
                badges: ["Экстрим"],
                features: ["Треккинг", "Палатки", "Питание"],
                description: "Активный отдых в горах для опытных туристов"
            },
            {
                id: 6,
                title: "Древний Хива - музей под открытым небом",
                location: "Узбекистан, Хива",
                duration: "2 дня",
                price: 320,
                rating: 4.8,
                reviews: 145,
                image: "https://images.unsplash.com/photo-1545558014-8692077e9b5c?w=400",
                badges: ["Культура"],
                features: ["Экскурсии", "Отель", "Гид"],
                description: "Погружение в атмосферу средневекового Востока"
            }
        ];

        // Load tours on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadTours();
            generateCalendar();
        });

        // Load tours function
        function loadTours() {
            const container = document.getElementById('toursContainer');
            const spinner = document.getElementById('loadingSpinner');
            
            // Show loading spinner
            spinner.classList.add('active');
            
            // Simulate API call
            setTimeout(() => {
                spinner.classList.remove('active');
                
                // Fetch from API or use sample data
                fetch('http://localhost:3001/api/tours')
                    .then(res => res.json())
                    .then(data => {
                        if (data.tours && data.tours.length > 0) {
                            displayTours(data.tours);
                        } else {
                            displayTours(sampleTours);
                        }
                    })
                    .catch(err => {
                        console.error('Error loading tours:', err);
                        displayTours(sampleTours);
                    });
            }, 500);
        }

        // Display tours
        function displayTours(tours) {
            const container = document.getElementById('toursContainer');
            const noResults = document.getElementById('noResults');
            
            if (tours.length === 0) {
                container.innerHTML = '';
                noResults.style.display = 'block';
                document.getElementById('resultsCount').textContent = '0';
                return;
            }
            
            noResults.style.display = 'none';
            document.getElementById('resultsCount').textContent = tours.length;
            
            container.innerHTML = tours.map(tour => {
                const title = tour.title?.ru || tour.title?.en || tour.title || 'Tour';
                const location = `${tour.country || 'Страна'}, ${tour.city || 'Город'}`;
                const duration = tour.durationDays ? `${tour.durationDays} дней` : tour.duration || '1 день';
                const price = tour.price || 0;
                const rating = tour.rating || 4.5;
                const reviews = tour.reviews || Math.floor(Math.random() * 200);
                const image = tour.image || `https://source.unsplash.com/400x300/?travel,${tour.country || 'asia'}`;
                const badges = tour.badges || [];
                const features = tour.features || ['Трансфер', 'Гид'];
                
                return `
                    <div class="tour-card" onclick="openTour(${tour.id})">
                        <img src="${image}" alt="${title}" class="tour-image">
                        <div class="tour-content">
                            ${badges.length > 0 ? `
                                <div class="tour-badges">
                                    ${badges.map(badge => `
                                        <span class="badge ${badge === 'Популярный' ? 'badge-popular' : 'badge-new'}">
                                            ${badge}
                                        </span>
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            <h3 class="tour-title">${title}</h3>
                            <p class="tour-location">
                                <i class="fas fa-map-marker-alt mr-2"></i>
                                ${location}
                            </p>
                            
                            <div class="tour-features">
                                <span><i class="fas fa-clock mr-1"></i> ${duration}</span>
                                ${features.slice(0, 2).map(f => `
                                    <span><i class="fas fa-check text-green-500 mr-1"></i> ${f}</span>
                                `).join('')}
                            </div>
                            
                            <div class="tour-rating">
                                <span class="rating-stars">${'★'.repeat(Math.floor(rating))}${'☆'.repeat(5-Math.floor(rating))}</span>
                                <span class="rating-text">${rating}</span>
                                <span class="rating-count">(${reviews} отзывов)</span>
                            </div>
                            
                            <div class="tour-price-section">
                                <div class="tour-price">
                                    <span class="price-label">от</span>
                                    <span class="price-amount">$${price}</span>
                                    <span class="price-label">/ чел</span>
                                </div>
                                <button class="btn-book" onclick="event.stopPropagation(); bookTour(${tour.id})">
                                    Забронировать
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Generate calendar
        function generateCalendar() {
            const grid = document.getElementById('dateGrid');
            const today = new Date();
            const daysInMonth = 30;
            
            grid.innerHTML = '';
            
            // Day headers
            const dayHeaders = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'text-xs font-semibold text-gray-500 text-center';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Empty cells for alignment
            for (let i = 0; i < 2; i++) {
                const empty = document.createElement('div');
                grid.appendChild(empty);
            }
            
            // Date cells
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'date-cell';
                
                // Random availability
                if (Math.random() > 0.3) {
                    cell.classList.add('available');
                    const price = Math.floor(Math.random() * 500) + 500;
                    cell.innerHTML = `
                        <span>${day}</span>
                        <span class="date-price">$${price}</span>
                    `;
                    cell.onclick = () => selectDate(day);
                } else {
                    cell.innerHTML = `<span>${day}</span>`;
                    cell.style.opacity = '0.5';
                    cell.style.cursor = 'not-allowed';
                }
                
                grid.appendChild(cell);
            }
        }

        // Calendar navigation
        let currentMonthOffset = 0;
        function changeMonth(direction) {
            currentMonthOffset += direction;
            const months = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 
                          'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
            const now = new Date();
            now.setMonth(now.getMonth() + currentMonthOffset);
            document.getElementById('currentMonth').textContent = 
                `${months[now.getMonth()]} ${now.getFullYear()}`;
            generateCalendar();
        }

        // Select date
        function selectDate(day) {
            document.querySelectorAll('.date-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            event.target.closest('.date-cell').classList.add('selected');
            
            // Update date input
            const now = new Date();
            now.setMonth(now.getMonth() + currentMonthOffset);
            now.setDate(day);
            document.getElementById('dateInput').value = 
                `${day.toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getFullYear()}`;
            
            // Trigger search
            searchTours();
        }

        // Update price display
        function updatePriceDisplay() {
            const value = document.getElementById('priceRange').value;
            document.getElementById('maxPrice').value = value;
            searchTours();
        }

        // Search tours
        function searchTours() {
            // Collect all filter values
            const filters = {
                search: document.getElementById('searchInput').value,
                date: document.getElementById('dateInput').value,
                guests: document.getElementById('guestsInput').value,
                minPrice: document.getElementById('minPrice').value,
                maxPrice: document.getElementById('maxPrice').value,
                countries: [],
                types: [],
                categories: [],
                durations: [],
                ratings: []
            };
            
            // Get checked filters
            document.querySelectorAll('.filter-option input[type="checkbox"]:checked').forEach(checkbox => {
                const id = checkbox.id;
                if (id.startsWith('country')) filters.countries.push(checkbox.nextElementSibling.textContent.trim());
                if (id.startsWith('type')) filters.types.push(checkbox.nextElementSibling.textContent.trim());
                if (id.startsWith('cat')) filters.categories.push(checkbox.nextElementSibling.textContent.trim());
                if (id.startsWith('dur')) filters.durations.push(checkbox.nextElementSibling.textContent.trim());
                if (id.startsWith('rating')) filters.ratings.push(checkbox.nextElementSibling.textContent.trim());
            });
            
            // Apply filters and reload tours
            loadTours();
        }

        // Sort tours
        function sortTours(sortBy) {
            // Implement sorting logic
            loadTours();
        }

        // Set view
        function setView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.view-btn').classList.add('active');
            
            // Implement grid/list view toggle
            if (view === 'grid') {
                document.getElementById('toursContainer').style.display = 'grid';
                document.getElementById('toursContainer').style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
            } else {
                document.getElementById('toursContainer').style.display = 'block';
            }
        }

        // Reset filters
        function resetFilters() {
            document.querySelectorAll('.filter-option input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('minPrice').value = 0;
            document.getElementById('maxPrice').value = 5000;
            document.getElementById('priceRange').value = 5000;
            searchTours();
        }

        // Toggle mobile filters
        function toggleMobileFilters() {
            document.getElementById('filterSidebar').classList.toggle('active');
        }

        // Open tour
        function openTour(tourId) {
            window.location.href = `tour-template.html?tour=${tourId}`;
        }

        // Book tour
        function bookTour(tourId) {
            window.location.href = `booking-flow.html?tourId=${tourId}`;
        }

        // Listen for filter changes
        document.querySelectorAll('.filter-option input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', searchTours);
        });
        
        document.getElementById('minPrice').addEventListener('input', searchTours);
        document.getElementById('maxPrice').addEventListener('input', searchTours);
    </script>
</body>
</html>