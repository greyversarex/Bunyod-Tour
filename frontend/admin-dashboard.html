<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель - Bunyod-Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f3f4f6;
        }
        
        .sidebar {
            width: 260px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .nav-item {
            color: rgba(255,255,255,0.8);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
        }
        
        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
        }
        
        .tab-button {
            padding: 10px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab-button:hover {
            color: #4b5563;
        }
        
        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #f9fafb;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .data-table tr:hover {
            background: #f9fafb;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 32px;
            position: relative;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge-warning {
            background: #fed7aa;
            color: #92400e;
        }
        
        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 10px;
            margin-bottom: 10px;
            display: inline-block;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .checkbox-item:hover {
            background: #f3f4f6;
        }
        
        .checkbox-item.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .search-bar {
            position: relative;
            max-width: 400px;
        }
        
        .search-bar input {
            width: 100%;
            padding: 10px 40px 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
        }
        
        .search-bar i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen bg-gradient-to-br from-purple-600 to-blue-500 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Админ-панель</h1>
                <p class="text-gray-600">Войдите в систему управления</p>
            </div>
            <form id="loginForm">
                <div class="mb-6">
                    <label class="form-label">Имя пользователя</label>
                    <input type="text" id="username" class="form-input" placeholder="admin" required>
                </div>
                <div class="mb-6">
                    <label class="form-label">Пароль</label>
                    <input type="password" id="password" class="form-input" placeholder="••••••••" required>
                </div>
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i>
                    Войти в систему
                </button>
                <div class="mt-4 text-center text-sm text-gray-500">
                    Тестовые данные: admin / admin123
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="p-6 border-b border-white/20">
                <h2 class="text-white text-xl font-bold">Bunyod-Tour</h2>
                <p class="text-white/60 text-sm mt-1">Панель управления</p>
            </div>
            
            <nav class="p-4">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>
                    <span>Главная</span>
                </a>
                <a href="#" class="nav-item" data-section="tours">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Туры</span>
                </a>
                <a href="#" class="nav-item" data-section="bookings">
                    <i class="fas fa-calendar-check"></i>
                    <span>Заказы</span>
                </a>
                <a href="#" class="nav-item" data-section="hotels">
                    <i class="fas fa-hotel"></i>
                    <span>Отели</span>
                </a>
                <a href="#" class="nav-item" data-section="guides">
                    <i class="fas fa-user-tie"></i>
                    <span>Гиды</span>
                </a>
                <a href="#" class="nav-item" data-section="customers">
                    <i class="fas fa-users"></i>
                    <span>Клиенты</span>
                </a>
                <a href="#" class="nav-item" data-section="reviews">
                    <i class="fas fa-star"></i>
                    <span>Отзывы</span>
                </a>
                <a href="#" class="nav-item" data-section="payments">
                    <i class="fas fa-credit-card"></i>
                    <span>Платежи</span>
                </a>
                <a href="#" class="nav-item" data-section="cms">
                    <i class="fas fa-edit"></i>
                    <span>CMS - Контент</span>
                </a>
                <a href="#" class="nav-item" data-section="translations">
                    <i class="fas fa-language"></i>
                    <span>Переводы</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Настройки</span>
                </a>
                <a href="#" class="nav-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Выход</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="bg-white shadow-sm px-6 py-4 flex justify-between items-center">
                <button class="lg:hidden" onclick="toggleSidebar()">
                    <i class="fas fa-bars text-gray-600 text-xl"></i>
                </button>
                <h1 class="text-2xl font-semibold text-gray-800" id="sectionTitle">Главная</h1>
                <div class="flex items-center gap-4">
                    <button class="relative">
                        <i class="fas fa-bell text-gray-600 text-xl"></i>
                        <span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">3</span>
                    </button>
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                            A
                        </div>
                        <span class="text-gray-700 font-medium">Администратор</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="p-6" id="contentArea">
                <!-- Dashboard Section -->
                <section id="dashboardSection">
                    <!-- Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-map text-blue-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+12%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">156</h3>
                            <p class="text-gray-600 text-sm mt-1">Активных туров</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-shopping-cart text-green-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+23%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">342</h3>
                            <p class="text-gray-600 text-sm mt-1">Заказов за месяц</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-dollar-sign text-purple-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+18%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">$45,678</h3>
                            <p class="text-gray-600 text-sm mt-1">Доход за месяц</p>
                        </div>
                        
                        <div class="stat-card">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-users text-orange-600 text-xl"></i>
                                </div>
                                <span class="text-green-500 text-sm font-medium">+8%</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800">1,234</h3>
                            <p class="text-gray-600 text-sm mt-1">Активных клиентов</p>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Последние заказы</h2>
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>№ Заказа</th>
                                        <th>Клиент</th>
                                        <th>Тур</th>
                                        <th>Дата</th>
                                        <th>Сумма</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="recentOrdersTable">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">График продаж</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Популярные направления</h3>
                            <div style="height: 300px; position: relative;">
                                <canvas id="destinationsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tours Section -->
                <section id="toursSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <div class="search-bar">
                            <input type="text" placeholder="Поиск туров..." id="tourSearch">
                            <i class="fas fa-search"></i>
                        </div>
                        <button class="btn btn-primary" onclick="openTourModal()">
                            <i class="fas fa-plus"></i>
                            Добавить тур
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Название</th>
                                        <th>Категория</th>
                                        <th>Страна</th>
                                        <th>Город</th>
                                        <th>Длительность</th>
                                        <th>Цена</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="toursTable">
                                    <!-- Tours will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Bookings Section -->
                <section id="bookingsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" data-status="all">Все заказы</button>
                            <button class="tab-button" data-status="pending">Ожидающие</button>
                            <button class="tab-button" data-status="confirmed">Подтвержденные</button>
                            <button class="tab-button" data-status="paid">Оплаченные</button>
                            <button class="tab-button" data-status="completed">Завершенные</button>
                            <button class="tab-button" data-status="cancelled">Отмененные</button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>№ Заказа</th>
                                        <th>Дата заказа</th>
                                        <th>Клиент</th>
                                        <th>Тур</th>
                                        <th>Дата тура</th>
                                        <th>Кол-во человек</th>
                                        <th>Сумма</th>
                                        <th>Оплата</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="bookingsTable">
                                    <!-- Bookings will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Hotels Section -->
                <section id="hotelsSection" style="display: none;">
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-semibold">Управление отелями</h2>
                            <button class="btn btn-primary" onclick="openHotelModal()">
                                <i class="fas fa-plus"></i>
                                Добавить отель
                            </button>
                        </div>
                        
                        <!-- Search and Filter -->
                        <div class="flex justify-between items-center mb-4">
                            <div class="search-bar">
                                <input type="text" id="hotelSearch" placeholder="Поиск отелей..." onkeyup="searchHotels()">
                                <i class="fas fa-search"></i>
                            </div>
                            <select id="hotelFilter" onchange="filterHotels()" class="form-input" style="max-width: 200px;">
                                <option value="">Все отели</option>
                                <option value="active">Активные</option>
                                <option value="inactive">Неактивные</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="hotelsList">
                        <!-- Hotels will be loaded here -->
                    </div>
                </section>

                <!-- Guides Section -->
                <section id="guidesSection" style="display: none;">
                    <div class="mb-6 flex justify-between items-center">
                        <h2 class="text-xl font-semibold">Управление гидами</h2>
                        <button class="btn btn-primary" onclick="openGuideModal()">
                            <i class="fas fa-plus"></i>
                            Добавить гида
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="guidesList">
                        <!-- Guides will be loaded here -->
                    </div>
                </section>

                <!-- Reviews Section -->
                <section id="reviewsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" data-filter="all">Все отзывы</button>
                            <button class="tab-button" data-filter="pending">На модерации</button>
                            <button class="tab-button" data-filter="approved">Одобренные</button>
                            <button class="tab-button" data-filter="rejected">Отклоненные</button>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="overflow-x-auto">
                            <table class="data-table w-full">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Дата</th>
                                        <th>Клиент</th>
                                        <th>Тур</th>
                                        <th>Рейтинг</th>
                                        <th>Отзыв</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="reviewsTable">
                                    <!-- Reviews will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- CMS Section -->
                <section id="cmsSection" style="display: none;">
                    <div class="mb-6">
                        <div class="flex gap-2 mb-4">
                            <button class="tab-button active" onclick="switchCMSTab('blocks')">Блоки туров</button>
                            <button class="tab-button" onclick="switchCMSTab('settings')">Настройки сайта</button>
                            <button class="tab-button" onclick="switchCMSTab('tours')">Форма туров</button>
                        </div>
                    </div>

                    <!-- Tour Blocks Tab -->
                    <div id="cmsBlocksTab">
                        <div class="mb-6 flex justify-between items-center">
                            <h2 class="text-xl font-semibold">Управление блоками туров</h2>
                            <button class="btn btn-primary" onclick="openTourBlockModal()">
                                <i class="fas fa-plus"></i>
                                Создать блок туров
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm">
                            <div class="overflow-x-auto">
                                <table class="data-table w-full">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Название блока (RU)</th>
                                            <th>Название блока (EN)</th>
                                            <th>Слаг</th>
                                            <th>Количество туров</th>
                                            <th>Статус</th>
                                            <th>Порядок</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tourBlocksTable">
                                        <!-- Tour blocks will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Site Settings Tab -->
                    <div id="cmsSettingsTab" style="display: none;">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold">Настройки сайта</h2>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <form id="siteSettingsForm">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <div class="form-group">
                                        <label class="form-label">Название сайта (RU)</label>
                                        <input type="text" class="form-input" id="siteTitle_ru" name="siteTitle_ru">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Название сайта (EN)</label>
                                        <input type="text" class="form-input" id="siteTitle_en" name="siteTitle_en">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Описание сайта (RU)</label>
                                        <textarea class="form-input" rows="3" id="siteDescription_ru" name="siteDescription_ru"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Описание сайта (EN)</label>
                                        <textarea class="form-input" rows="3" id="siteDescription_en" name="siteDescription_en"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" id="contactEmail" name="contactEmail">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Телефон</label>
                                        <input type="text" class="form-input" id="contactPhone" name="contactPhone">
                                    </div>
                                </div>
                                <div class="mt-6">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Сохранить настройки
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Enhanced Tours Form Tab -->
                    <div id="cmsToursTab" style="display: none;">
                        <div class="mb-6">
                            <h2 class="text-xl font-semibold">Расширенная форма создания туров</h2>
                            <p class="text-gray-600">Создавайте туры со всеми необходимыми полями для карточек и страниц туров</p>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <form id="enhancedTourForm">
                                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    <!-- Basic Info -->
                                    <div class="lg:col-span-2">
                                        <h3 class="text-lg font-semibold mb-4">Основная информация</h3>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Название тура (RU)</label>
                                        <input type="text" class="form-input" id="eTourTitleRu" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Название тура (EN)</label>
                                        <input type="text" class="form-input" id="eTourTitleEn" required>
                                    </div>
                                    
                                    <div class="form-group lg:col-span-2">
                                        <label class="form-label">Краткое описание (для карточек)</label>
                                        <textarea class="form-input" rows="3" id="eTourShortDesc" placeholder="Краткое описание для отображения на карточке тура"></textarea>
                                    </div>
                                    
                                    <div class="form-group lg:col-span-2">
                                        <label class="form-label">Полное описание</label>
                                        <textarea class="form-input" rows="5" id="eTourFullDesc"></textarea>
                                    </div>
                                    
                                    <!-- Pricing -->
                                    <div class="lg:col-span-2">
                                        <h3 class="text-lg font-semibold mb-4 mt-6">Цены и детали</h3>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Цена</label>
                                        <input type="number" class="form-input" id="eTourPrice" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Тип цены</label>
                                        <select class="form-input" id="eTourPriceType" required>
                                            <option value="за человека">За человека</option>
                                            <option value="за группу">За группу</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Оригинальная цена (для скидки)</label>
                                        <input type="number" class="form-input" id="eTourOriginalPrice">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Количество дней</label>
                                        <input type="number" class="form-input" id="eTourDurationDays" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Сложность</label>
                                        <select class="form-input" id="eTourDifficulty">
                                            <option value="">Выберите сложность</option>
                                            <option value="Easy">Легкий</option>
                                            <option value="Medium">Средний</option>
                                            <option value="Hard">Сложный</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Максимум людей</label>
                                        <input type="number" class="form-input" id="eTourMaxPeople">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Минимум людей</label>
                                        <input type="number" class="form-input" id="eTourMinPeople">
                                    </div>
                                    
                                    <!-- Location -->
                                    <div class="form-group">
                                        <label class="form-label">Страна</label>
                                        <select class="form-input" id="eTourCountry">
                                            <option value="">Выберите страну</option>
                                            <option value="Uzbekistan">Узбекистан</option>
                                            <option value="Tajikistan">Таджикистан</option>
                                            <option value="Kyrgyzstan">Кыргызстан</option>
                                            <option value="Kazakhstan">Казахстан</option>
                                            <option value="Turkmenistan">Туркменистан</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Город</label>
                                        <input type="text" class="form-input" id="eTourCity">
                                    </div>
                                    
                                    <!-- Images -->
                                    <div class="lg:col-span-2">
                                        <h3 class="text-lg font-semibold mb-4 mt-6">Изображения</h3>
                                    </div>
                                    
                                    <div class="form-group lg:col-span-2">
                                        <label class="form-label">Главное изображение (URL)</label>
                                        <input type="url" class="form-input" id="eTourMainImage" placeholder="https://example.com/image.jpg">
                                    </div>
                                    
                                    <!-- Block Assignment -->
                                    <div class="lg:col-span-2">
                                        <h3 class="text-lg font-semibold mb-4 mt-6">Размещение в блоке</h3>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Блок туров</label>
                                        <select class="form-input" id="eTourBlockId">
                                            <option value="">Выберите блок туров</option>
                                            <!-- Tour blocks will be loaded here -->
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Категория</label>
                                        <select class="form-input" id="eTourCategoryId" required>
                                            <option value="">Выберите категорию</option>
                                            <!-- Categories will be loaded here -->
                                        </select>
                                    </div>
                                    
                                    <div class="form-group lg:col-span-2">
                                        <label class="form-label flex items-center">
                                            <input type="checkbox" id="eTourIsFeatured" class="mr-2">
                                            Рекомендуемый тур
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="mt-6">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i>
                                        Создать тур
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Translations Section -->
                <section id="translationsSection" style="display: none;">
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Автоматический перевод туров</h2>
                        <p class="text-gray-600">Используйте искусственный интеллект для автоматического перевода содержания туров на поддерживаемые языки</p>
                    </div>
                    
                    <!-- Translation Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-language text-blue-600 text-xl"></i>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800" id="supportedLanguagesCount">6</h3>
                            <p class="text-gray-600 text-sm mt-1">Поддерживаемых языков</p>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800" id="translatedToursCount">0</h3>
                            <p class="text-gray-600 text-sm mt-1">Полностью переведенных туров</p>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-clock text-orange-600 text-xl"></i>
                                </div>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800" id="pendingTranslationsCount">0</h3>
                            <p class="text-gray-600 text-sm mt-1">Требует перевода</p>
                        </div>
                    </div>

                    <!-- Translation Tools -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Single Tour Translation -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-map-marker-alt text-blue-600 mr-2"></i>
                                Перевести один тур
                            </h3>
                            <p class="text-gray-600 mb-6 text-sm">Выберите конкретный тур для автоматического перевода на недостающие языки</p>
                            
                            <form id="singleTranslationForm">
                                <div class="form-group mb-4">
                                    <label class="form-label">Выберите тур</label>
                                    <select class="form-input" id="translationTourSelect" required>
                                        <option value="">-- Выберите тур --</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn btn-primary w-full" id="translateSingleBtn">
                                    <i class="fas fa-language mr-2"></i>
                                    Перевести тур
                                </button>
                            </form>
                        </div>

                        <!-- Batch Translation -->
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">
                                <i class="fas fa-globe text-green-600 mr-2"></i>
                                Массовый перевод
                            </h3>
                            <p class="text-gray-600 mb-6 text-sm">Переведите все туры или выбранные туры одновременно</p>
                            
                            <div class="space-y-4">
                                <button class="btn btn-success w-full" onclick="batchTranslateAllTours()">
                                    <i class="fas fa-rocket mr-2"></i>
                                    Перевести все туры
                                </button>
                                
                                <button class="btn btn-outline w-full" onclick="showBatchTranslationModal()">
                                    <i class="fas fa-check-square mr-2"></i>
                                    Выбрать туры для перевода
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Manual Text Translation -->
                    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                        <h3 class="text-lg font-semibold mb-4">
                            <i class="fas fa-edit text-purple-600 mr-2"></i>
                            Ручной перевод текста
                        </h3>
                        <p class="text-gray-600 mb-6 text-sm">Переведите любой текст с одного языка на другой</p>
                        
                        <form id="manualTranslationForm" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <div class="form-group mb-4">
                                    <label class="form-label">Исходный язык</label>
                                    <select class="form-input" id="sourceLanguage" required>
                                        <option value="ru">Русский</option>
                                        <option value="en">English</option>
                                        <option value="tj">Тоҷикӣ (Tajik)</option>
                                        <option value="fa">فارسی (Farsi)</option>
                                        <option value="de">Deutsch</option>
                                        <option value="zh">中文 (Chinese)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Исходный текст</label>
                                    <textarea class="form-input" id="sourceText" rows="8" placeholder="Введите текст для перевода..." required></textarea>
                                </div>
                            </div>
                            
                            <div>
                                <div class="form-group mb-4">
                                    <label class="form-label">Целевой язык</label>
                                    <select class="form-input" id="targetLanguage" required>
                                        <option value="en">English</option>
                                        <option value="ru">Русский</option>
                                        <option value="tj">Тоҷикӣ (Tajik)</option>
                                        <option value="fa">فارسی (Farsi)</option>
                                        <option value="de">Deutsch</option>
                                        <option value="zh">中文 (Chinese)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Переведенный текст</label>
                                    <textarea class="form-input" id="translatedText" rows="8" placeholder="Переведенный текст появится здесь..." readonly></textarea>
                                </div>
                            </div>
                            
                            <div class="lg:col-span-2">
                                <button type="submit" class="btn btn-primary" id="manualTranslateBtn">
                                    <i class="fas fa-arrow-right mr-2"></i>
                                    Перевести текст
                                </button>
                                
                                <button type="button" class="btn btn-outline ml-4" onclick="copyTranslation()">
                                    <i class="fas fa-copy mr-2"></i>
                                    Копировать перевод
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Translation Progress -->
                    <div class="bg-white rounded-xl shadow-sm p-6" id="translationProgress" style="display: none;">
                        <h3 class="text-lg font-semibold mb-4">
                            <i class="fas fa-spinner fa-spin text-blue-600 mr-2"></i>
                            Прогресс перевода
                        </h3>
                        <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                        </div>
                        <p class="text-sm text-gray-600" id="progressText">Подготовка к переводу...</p>
                        <div id="translationResults" class="mt-4 space-y-2"></div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settingsSection" style="display: none;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">Общие настройки</h3>
                            <form id="generalSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">Название компании</label>
                                    <input type="text" class="form-input" value="Bunyod-Tour">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email администратора</label>
                                    <input type="email" class="form-input" value="admin@bunyod-tour.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email сообщества</label>
                                    <input type="email" class="form-input" value="community@bunyod-tour.com">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Телефон поддержки</label>
                                    <input type="tel" class="form-input" value="+992 123 456 789">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Сохранить изменения
                                </button>
                            </form>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">Настройки платежей</h3>
                            <form id="paymentSettingsForm">
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> Payme
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="Merchant ID">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> Click
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="Service ID">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> Stripe
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="API Key">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <input type="checkbox" checked> PayPal
                                    </label>
                                    <input type="text" class="form-input mt-2" placeholder="Client ID">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Сохранить настройки
                                </button>
                            </form>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Hotel Modal -->
    <div id="hotelModal" class="modal">
        <div class="modal-content" style="width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="hotelModalTitle">Добавить отель</h2>
                <button onclick="closeHotelModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="hotelForm">
                <div class="grid grid-cols-1 gap-4">
                    <div class="form-group">
                        <label class="form-label">Название отеля (Русский)</label>
                        <input type="text" class="form-input" id="hotelNameRu" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Название отеля (English)</label>
                        <input type="text" class="form-input" id="hotelNameEn" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Название отеля (Таджикский)</label>
                        <input type="text" class="form-input" id="hotelNameTj">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Описание (Русский)</label>
                        <textarea class="form-input" rows="4" id="hotelDescRu" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Описание (English)</label>
                        <textarea class="form-input" rows="4" id="hotelDescEn" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Описание (Таджикский)</label>
                        <textarea class="form-input" rows="4" id="hotelDescTj"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Адрес</label>
                        <input type="text" class="form-input" id="hotelAddress" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Рейтинг (1-5)</label>
                        <input type="number" class="form-input" id="hotelRating" min="1" max="5" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Тип питания</label>
                        <select class="form-input" id="hotelPension">
                            <option value="none">Не включено</option>
                            <option value="half">Полупансион (завтрак)</option>
                            <option value="full">Полный пансион (завтрак + обед)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Фотографии отеля</label>
                        <input type="file" class="form-input" id="hotelImages" multiple accept="image/*">
                        <div id="hotelImagePreview" class="mt-2"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Удобства</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" value="WiFi"> WiFi
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Завтрак"> Завтрак
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Парковка"> Парковка
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Ресторан"> Ресторан
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Бассейн"> Бассейн
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Спа"> Спа
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Фитнес"> Фитнес-центр
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Кондиционер"> Кондиционер
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="hotelActive" checked> Активный
                        </label>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeHotelModal()" class="btn btn-secondary">
                        Отмена
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tour Modal -->
    <div id="tourModal" class="modal">
        <div class="modal-content" style="width: 800px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">Добавить/Редактировать тур</h2>
                <button onclick="closeTourModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="tourForm">
                <div class="grid grid-cols-2 gap-4">
                    <div class="form-group col-span-2">
                        <label class="form-label">Название тура (Русский)</label>
                        <input type="text" class="form-input" id="tourTitleRu" required>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Название тура (English)</label>
                        <input type="text" class="form-input" id="tourTitleEn" required>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Описание (Русский)</label>
                        <textarea class="form-input" rows="4" id="tourDescRu" required></textarea>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Описание (English)</label>
                        <textarea class="form-input" rows="4" id="tourDescEn" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Категория</label>
                        <select class="form-input" id="tourCategory" required>
                            <option value="">Выберите категорию</option>
                            <option value="1">Городские туры</option>
                            <option value="2">Природа/экологические туры</option>
                            <option value="3">Культурно познавательные туры</option>
                            <option value="4">Исторические туры</option>
                            <option value="5">Походы/трекинги</option>
                            <option value="6">Горные ландшафты</option>
                            <option value="7">Озерные ландшафты</option>
                            <option value="8">Приключенческие туры</option>
                            <option value="9">Гастрономические туры</option>
                            <option value="10">Автотуры/сафари/джип-туры</option>
                            <option value="11">Агротуры</option>
                            <option value="12">VIP туры</option>
                            <option value="13">MICE/корпоративные туры</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Блок тура</label>
                        <select class="form-input" id="tourBlockId">
                            <option value="">Выберите блок</option>
                            <option value="1">Популярные туры</option>
                            <option value="2">Рекомендованные туры по Центральной Азии</option>
                            <option value="3">Туры по Таджикистану</option>
                            <option value="4">Туры по Узбекистану</option>
                            <option value="5">Туры по Киргизстану</option>
                            <option value="6">Туры по Туркменистану</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Страна</label>
                        <select class="form-input" id="tourCountry" required>
                            <option value="">Выберите страну</option>
                            <option value="Таджикистан">Таджикистан</option>
                            <option value="Узбекистан">Узбекистан</option>
                            <option value="Казахстан">Казахстан</option>
                            <option value="Кыргызстан">Кыргызстан</option>
                            <option value="Туркменистан">Туркменистан</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Город</label>
                        <input type="text" class="form-input" id="tourCity" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Длительность (дней)</label>
                        <input type="number" class="form-input" id="tourDurationDays" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Продолжительность (например: "6-7 часов (прибл.)")</label>
                        <input type="text" class="form-input" id="tourDuration" placeholder="6-7 часов (прибл.)">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Формат тура</label>
                        <select class="form-input" id="tourFormat" required>
                            <option value="">Выберите формат</option>
                            <option value="Персональный">Персональный</option>
                            <option value="Групповой персональный">Групповой персональный</option>
                            <option value="Групповой общий">Групповой общий</option>
                            <option value="VIP">VIP</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Цена (USD)</label>
                        <input type="number" class="form-input" id="tourPrice" min="0" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Тип цены</label>
                        <select class="form-input" id="tourPriceType" required>
                            <option value="за человека">За человека</option>
                            <option value="за группу">За группу</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Дата начала</label>
                        <input type="date" class="form-input" id="tourStartDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Дата окончания</label>
                        <input type="date" class="form-input" id="tourEndDate">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Приём пищи</label>
                        <select class="form-input" id="tourMealsIncluded">
                            <option value="false">Приём не включен</option>
                            <option value="true">Приём включен</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Языки тура (через запятую)</label>
                        <input type="text" class="form-input" id="tourLanguages" placeholder="Русский, Английский, Таджикский">
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Фотографии</label>
                        <input type="file" class="form-input" id="tourImages" multiple accept="image/*">
                        <div id="imagePreview" class="mt-2"></div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Услуги включенные в тур</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" value="Трансфер"> Трансфер
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Проживание"> Проживание
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Питание"> Питание
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Гид"> Гид
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Входные билеты"> Входные билеты
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="Страховка"> Страховка
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Связанные отели</label>
                        <div class="checkbox-group" id="hotelCheckboxes">
                            <!-- Hotels will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="form-group col-span-2">
                        <label class="form-label">Доступные гиды</label>
                        <div class="checkbox-group" id="guideCheckboxes">
                            <!-- Guides will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeTourModal()" class="btn btn-secondary">
                        Отмена
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Booking Details Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content" style="width: 700px;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">Детали заказа</h2>
                <button onclick="closeBookingModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="bookingDetails">
                <!-- Booking details will be loaded here -->
            </div>
            
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeBookingModal()" class="btn btn-secondary">
                    Закрыть
                </button>
                <button onclick="confirmBooking()" class="btn btn-success">
                    <i class="fas fa-check"></i>
                    Подтвердить
                </button>
                <button onclick="cancelBooking()" class="btn btn-danger">
                    <i class="fas fa-times"></i>
                    Отменить
                </button>
            </div>
        </div>
    </div>

    <!-- Content Block Modal -->
    <div id="contentBlockModal" class="modal">
        <div class="modal-content" style="width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="contentBlockModalTitle">Добавить блок контента</h2>
                <button onclick="closeContentBlockModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="contentBlockForm">
                <div class="grid grid-cols-1 gap-4">
                    <div class="form-group">
                        <label class="form-label">Тип блока</label>
                        <select class="form-input" id="blockType" required>
                            <option value="">Выберите тип</option>
                            <option value="hero_banner">Главный баннер</option>
                            <option value="about_section">О нас</option>
                            <option value="services_section">Услуги</option>
                            <option value="tours_section">Туры</option>
                            <option value="testimonials">Отзывы</option>
                            <option value="contact_info">Контакты</option>
                            <option value="footer_text">Текст футера</option>
                            <option value="custom">Пользовательский</option>
                        </select>
                    </div>
                    
                    <!-- Multilingual fields for each supported language -->
                    <div class="form-group">
                        <label class="form-label">Заголовок (Русский)</label>
                        <input type="text" class="form-input" id="blockTitle_ru">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Заголовок (English)</label>
                        <input type="text" class="form-input" id="blockTitle_en">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Заголовок (Тоҷикӣ)</label>
                        <input type="text" class="form-input" id="blockTitle_tj">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Заголовок (فارسی)</label>
                        <input type="text" class="form-input" id="blockTitle_fa">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Заголовок (Deutsch)</label>
                        <input type="text" class="form-input" id="blockTitle_de">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Заголовок (中文)</label>
                        <input type="text" class="form-input" id="blockTitle_zh">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Содержание (Русский)</label>
                        <textarea class="form-input" rows="4" id="blockContent_ru"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Содержание (English)</label>
                        <textarea class="form-input" rows="4" id="blockContent_en"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Содержание (Тоҷикӣ)</label>
                        <textarea class="form-input" rows="4" id="blockContent_tj"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Содержание (فارسی)</label>
                        <textarea class="form-input" rows="4" id="blockContent_fa"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Содержание (Deutsch)</label>
                        <textarea class="form-input" rows="4" id="blockContent_de"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Содержание (中文)</label>
                        <textarea class="form-input" rows="4" id="blockContent_zh"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Порядок отображения</label>
                        <input type="number" class="form-input" id="blockOrder" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="blockActive" checked>
                            Активен
                        </label>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="closeContentBlockModal()" class="btn btn-secondary">
                        Отмена
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Сохранить
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let currentSection = 'dashboard';
        let currentBookingId = null;
        let currentTourId = null;
        let currentContentBlockId = null;
        
        // API URL Configuration
        function getApiUrl() {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            
            console.log('Current location:', {
                hostname: hostname,
                protocol: protocol,
                port: window.location.port,
                href: window.location.href
            });
            
            // For local development
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                return 'http://localhost:3001/api';
            }
            
            // For Replit - API доступен на том же домене и порту
            if (hostname.includes('replit')) {
                // В Replit используем тот же порт что и для фронтенда  
                const currentPort = window.location.port;
                if (currentPort && currentPort !== '80' && currentPort !== '443') {
                    const apiUrl = `${protocol}//${hostname}:${currentPort}/api`;
                    console.log('Using API_BASE:', apiUrl);
                    return apiUrl;
                } else {
                    const apiUrl = `${protocol}//${hostname}/api`;
                    console.log('Using API_BASE:', apiUrl);
                    return apiUrl;
                }
            }
            
            // Попробовать тот же хост с портом 3001
            const apiUrl = `${protocol}//${hostname}:3001/api`;
            console.log('Using API_BASE:', apiUrl);
            return apiUrl;
        }

        // Authorization helper
        function getAuthHeaders() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                return {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                };
            }
            return {
                'Content-Type': 'application/json'
            };
        }
        
        // Authentication
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // API login using unified server
            const apiUrl = getApiUrl();
            
            fetch(`${apiUrl}/admin/login`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, password })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('adminToken', data.data.token);
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('adminDashboard').style.display = 'block';
                    loadDashboard();
                } else {
                    alert('Неверные учетные данные: ' + (data.message || 'Ошибка авторизации'));
                }
            })
            .catch(err => {
                console.error('Login error:', err);
                alert('Ошибка соединения с сервером');
            });
        });
        
        function logout() {
            if (confirm('Вы уверены, что хотите выйти?')) {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
            }
        }
        
        // Navigation
        document.querySelectorAll('.nav-item[data-section]').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const section = this.dataset.section;
                switchSection(section);
                
                // Update active state
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        function switchSection(section) {
            // Hide all sections
            document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
            
            // Show selected section
            const sectionElement = document.getElementById(section + 'Section');
            if (sectionElement) {
                sectionElement.style.display = 'block';
            }
            
            // Update title
            const titles = {
                dashboard: 'Главная',
                tours: 'Управление турами',
                bookings: 'Управление заказами',
                hotels: 'Управление отелями',
                guides: 'Управление гидами',
                customers: 'Клиенты',
                reviews: 'Модерация отзывов',
                payments: 'Платежи',
                cms: 'CMS - Управление контентом',
                settings: 'Настройки'
            };
            document.getElementById('sectionTitle').textContent = titles[section] || 'Админ-панель';
            
            // Load section data
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'tours':
                    loadTours();
                    break;
                case 'bookings':
                    loadBookings();
                    break;
                case 'hotels':
                    loadHotels();
                    break;
                case 'guides':
                    loadGuides();
                    break;
                case 'reviews':
                    loadReviews();
                    break;
                case 'cms':
                    loadCMSContentBlocks();
                    break;
            }
        }
        
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebar').classList.toggle('collapsed');
            document.getElementById('mainContent').classList.toggle('expanded');
        }
        
        // Dashboard functions
        function loadDashboard() {
            loadRecentOrders();
            loadCharts();
        }
        
        function loadRecentOrders() {
            fetch(`${getApiUrl()}/orders?limit=5`, {
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('recentOrdersTable');
                    if (!data.orders || data.orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">Нет заказов</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = data.orders.map(order => `
                        <tr>
                            <td class="font-medium">${order.orderNumber || 'N/A'}</td>
                            <td>${order.customer?.fullName || 'Неизвестно'}</td>
                            <td>${getTourName(order.tour)}</td>
                            <td>${formatDate(order.createdAt)}</td>
                            <td class="font-semibold">$${order.totalAmount}</td>
                            <td>${getStatusBadge(order.status)}</td>
                            <td>
                                <button onclick="viewBooking(${order.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(err => {
                    console.error('Error loading orders:', err);
                    document.getElementById('recentOrdersTable').innerHTML = 
                        '<tr><td colspan="7" class="text-center text-red-500">Ошибка загрузки данных</td></tr>';
                });
        }
        
        function loadCharts() {
            // Sales Chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'],
                        datasets: [{
                            label: 'Продажи',
                            data: [12000, 19000, 15000, 25000, 22000, 30000],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Destinations Chart
            const destCtx = document.getElementById('destinationsChart');
            if (destCtx) {
                new Chart(destCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Таджикистан', 'Узбекистан', 'Казахстан', 'Кыргызстан'],
                        datasets: [{
                            data: [45, 25, 20, 10],
                            backgroundColor: ['#667eea', '#10b981', '#f59e0b', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }
        
        // Tours functions
        function loadTours() {
            fetch(`${getApiUrl()}/tours`)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('toursTable');
                    const tours = data.data || data.tours || [];
                    if (tours.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="9" class="text-center text-gray-500">Нет туров</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = tours.map(tour => {
                        const title = typeof tour.title === 'string' ? JSON.parse(tour.title || '{}') : tour.title || {};
                        const categoryName = tour.category ? 
                            (typeof tour.category.name === 'string' ? JSON.parse(tour.category.name || '{}') : tour.category.name || {}) :
                            {};
                        return `
                            <tr>
                                <td>${tour.id}</td>
                                <td class="font-medium">${title.ru || title.en || 'Без названия'}</td>
                                <td>${categoryName.ru || categoryName.en || 'Без категории'}</td>
                                <td>${tour.country || '-'}</td>
                                <td>${tour.city || '-'}</td>
                                <td>${tour.duration || tour.durationDays || '-'} дней</td>
                                <td class="font-semibold">$${tour.price}</td>
                                <td>${tour.isActive ? 
                                    '<span class="badge badge-success">Активен</span>' : 
                                    '<span class="badge badge-danger">Неактивен</span>'}</td>
                                <td>
                                    <button onclick="editTour(${tour.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteTour(${tour.id})" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                })
                .catch(err => {
                    console.error('Error loading tours:', err);
                    document.getElementById('toursTable').innerHTML = 
                        '<tr><td colspan="9" class="text-center text-red-500">Ошибка загрузки данных</td></tr>';
                });
        }
        
        function openTourModal(tourId = null) {
            currentTourId = tourId;
            document.getElementById('tourModal').classList.add('active');
            
            // Load hotels and guides for checkboxes
            loadHotelsForCheckboxes();
            loadGuidesForCheckboxes();
            
            if (tourId) {
                // Load tour data for editing
                fetch(`http://localhost:3001/api/tours/${tourId}`)
                    .then(res => res.json())
                    .then(data => {
                        const tour = data.tour;
                        const title = JSON.parse(tour.title || '{}');
                        const description = JSON.parse(tour.description || '{}');
                        
                        document.getElementById('tourTitleRu').value = title.ru || '';
                        document.getElementById('tourTitleEn').value = title.en || '';
                        document.getElementById('tourDescRu').value = description.ru || '';
                        document.getElementById('tourDescEn').value = description.en || '';
                        document.getElementById('tourCategory').value = tour.categoryId || '';
                        document.getElementById('tourCountry').value = tour.country || '';
                        document.getElementById('tourCity').value = tour.city || '';
                        document.getElementById('tourDurationDays').value = tour.durationDays || '';
                        document.getElementById('tourDuration').value = tour.duration || '';
                        document.getElementById('tourFormat').value = tour.format || '';
                        document.getElementById('tourPrice').value = tour.price || '';
                        document.getElementById('tourPriceType').value = tour.priceType || 'за человека';
                        document.getElementById('tourMealsIncluded').value = tour.mealsIncluded ? 'true' : 'false';
                        
                        // Обработка языков
                        let languages = '';
                        if (tour.languages) {
                            try {
                                const langArray = JSON.parse(tour.languages);
                                languages = langArray.join(', ');
                            } catch (e) {
                                languages = tour.languages;
                            }
                        }
                        document.getElementById('tourLanguages').value = languages;
                        document.getElementById('tourStartDate').value = tour.startDate || '';
                        document.getElementById('tourEndDate').value = tour.endDate || '';
                    });
            }
        }
        
        function closeTourModal() {
            document.getElementById('tourModal').classList.remove('active');
            document.getElementById('tourForm').reset();
            currentTourId = null;
        }
        
        function loadHotelsForCheckboxes() {
            fetch(`${getApiUrl()}/hotels`)
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('hotelCheckboxes');
                    const hotels = data.data || data.hotels || [];
                    container.innerHTML = hotels.map(hotel => {
                        const name = typeof hotel.name === 'string' ? JSON.parse(hotel.name || '{}') : hotel.name || {};
                        return `
                            <label class="checkbox-item">
                                <input type="checkbox" value="${hotel.id}"> ${name.ru || name.en || 'Отель'}
                            </label>
                        `;
                    }).join('');
                });
        }
        
        function loadGuidesForCheckboxes() {
            fetch(`${getApiUrl()}/guides`)
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('guideCheckboxes');
                    const guides = data.data || data.guides || [];
                    container.innerHTML = guides.map(guide => {
                        const name = typeof guide.name === 'string' ? JSON.parse(guide.name || '{}') : guide.name || {};
                        return `
                            <label class="checkbox-item">
                                <input type="checkbox" value="${guide.id}"> ${name.ru || name.en || 'Гид'}
                            </label>
                        `;
                    }).join('');
                });
        }
        
        // Hotels functions
        let currentHotelId = null;
        
        function loadHotels() {
            const apiUrl = getApiUrl();
            fetch(`${apiUrl}/hotels`)
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('hotelsList');
                    if (!data.data || data.data.length === 0) {
                        container.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">Нет отелей</div>';
                        return;
                    }
                    
                    container.innerHTML = data.data.map(hotel => createHotelCard(hotel)).join('');
                })
                .catch(err => {
                    console.error('Error loading hotels:', err);
                    document.getElementById('hotelsList').innerHTML = 
                        '<div class="col-span-full text-center py-12 text-red-500">Ошибка загрузки данных</div>';
                });
        }
        
        function createHotelCard(hotel) {
            const name = JSON.parse(hotel.name || '{}');
            const description = JSON.parse(hotel.description || '{}');
            const amenities = JSON.parse(hotel.amenities || '[]');
            const images = JSON.parse(hotel.images || '[]');
            
            return `
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="relative">
                        ${images.length > 0 ? `
                            <img src="${images[0]}" alt="${name.ru || name.en || 'Hotel'}" class="w-full h-48 object-cover">
                            ${images.length > 1 ? `
                                <div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm">
                                    +${images.length - 1} фото
                                </div>
                            ` : ''}
                        ` : `
                            <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                                <i class="fas fa-hotel text-gray-400 text-3xl"></i>
                            </div>
                        `}
                        <div class="absolute top-2 left-2">
                            ${hotel.isActive ? 
                                '<span class="badge badge-success">Активен</span>' : 
                                '<span class="badge badge-danger">Неактивен</span>'}
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <h3 class="font-semibold text-lg mb-2">${name.ru || name.en || 'Отель'}</h3>
                        <p class="text-gray-600 text-sm mb-3 line-clamp-2">${description.ru || description.en || 'Описание отсутствует'}</p>
                        
                        <div class="flex items-center mb-3">
                            <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i>
                            <span class="text-sm text-gray-600">${hotel.address || 'Адрес не указан'}</span>
                        </div>
                        
                        ${hotel.rating ? `
                            <div class="flex items-center mb-3">
                                <div class="flex text-yellow-400">
                                    ${'★'.repeat(Math.floor(hotel.rating))}${'☆'.repeat(5 - Math.floor(hotel.rating))}
                                </div>
                                <span class="ml-2 text-sm text-gray-600">${hotel.rating}/5</span>
                            </div>
                        ` : ''}
                        
                        ${amenities.length > 0 ? `
                            <div class="mb-4">
                                <div class="flex flex-wrap gap-1">
                                    ${amenities.slice(0, 3).map(amenity => `
                                        <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">${amenity}</span>
                                    `).join('')}
                                    ${amenities.length > 3 ? `
                                        <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">+${amenities.length - 3}</span>
                                    ` : ''}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="flex justify-between items-center">
                            <button onclick="editHotel(${hotel.id})" class="btn btn-primary btn-sm">
                                <i class="fas fa-edit mr-1"></i> Редактировать
                            </button>
                            <button onclick="deleteHotel(${hotel.id})" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash mr-1"></i> Удалить
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function openHotelModal(hotelId = null) {
            currentHotelId = hotelId;
            document.getElementById('hotelModal').classList.add('active');
            
            if (hotelId) {
                document.getElementById('hotelModalTitle').textContent = 'Редактировать отель';
                loadHotelData(hotelId);
            } else {
                document.getElementById('hotelModalTitle').textContent = 'Добавить отель';
                document.getElementById('hotelForm').reset();
                document.getElementById('hotelImagePreview').innerHTML = '';
            }
        }
        
        function closeHotelModal() {
            document.getElementById('hotelModal').classList.remove('active');
            document.getElementById('hotelForm').reset();
            document.getElementById('hotelImagePreview').innerHTML = '';
            currentHotelId = null;
        }
        
        function loadHotelData(hotelId) {
            const apiUrl = getApiUrl();
            fetch(`${apiUrl}/hotels/${hotelId}`)
                .then(res => res.json())
                .then(data => {
                    const hotel = data.data;
                    const name = JSON.parse(hotel.name || '{}');
                    const description = JSON.parse(hotel.description || '{}');
                    const amenities = JSON.parse(hotel.amenities || '[]');
                    
                    document.getElementById('hotelNameRu').value = name.ru || '';
                    document.getElementById('hotelNameEn').value = name.en || '';
                    document.getElementById('hotelNameTj').value = name.tj || '';
                    document.getElementById('hotelDescRu').value = description.ru || '';
                    document.getElementById('hotelDescEn').value = description.en || '';
                    document.getElementById('hotelDescTj').value = description.tj || '';
                    document.getElementById('hotelAddress').value = hotel.address || '';
                    document.getElementById('hotelRating').value = hotel.rating || '';
                    document.getElementById('hotelPension').value = hotel.pension || 'none';
                    document.getElementById('hotelActive').checked = hotel.isActive;
                    
                    // Set amenities
                    document.querySelectorAll('#hotelForm input[type="checkbox"]').forEach(checkbox => {
                        if (checkbox.id !== 'hotelActive') {
                            checkbox.checked = amenities.includes(checkbox.value);
                        }
                    });
                })
                .catch(err => {
                    console.error('Error loading hotel data:', err);
                    alert('Ошибка загрузки данных отеля');
                });
        }
        
        function editHotel(hotelId) {
            openHotelModal(hotelId);
        }
        
        function deleteHotel(hotelId) {
            if (!confirm('Вы уверены, что хотите удалить этот отель?')) {
                return;
            }
            
            const apiUrl = getApiUrl();
            fetch(`${apiUrl}/hotels/${hotelId}`, {
                method: 'DELETE',
                headers: getAuthHeaders()
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Отель успешно удален');
                        loadHotels();
                    } else {
                        alert('Ошибка при удалении отеля: ' + (data.message || 'Неизвестная ошибка'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting hotel:', err);
                    alert('Ошибка при удалении отеля');
                });
        }
        
        function searchHotels() {
            const searchTerm = document.getElementById('hotelSearch').value.toLowerCase();
            const hotelCards = document.querySelectorAll('#hotelsList > div');
            
            hotelCards.forEach(card => {
                const text = card.textContent.toLowerCase();
                card.style.display = text.includes(searchTerm) ? 'block' : 'none';
            });
        }
        
        function filterHotels() {
            const filter = document.getElementById('hotelFilter').value;
            const hotelCards = document.querySelectorAll('#hotelsList > div');
            
            hotelCards.forEach(card => {
                if (filter === '') {
                    card.style.display = 'block';
                } else if (filter === 'active') {
                    const isActive = card.innerHTML.includes('badge-success');
                    card.style.display = isActive ? 'block' : 'none';
                } else if (filter === 'inactive') {
                    const isInactive = card.innerHTML.includes('badge-danger');
                    card.style.display = isInactive ? 'block' : 'none';
                }
            });
        }
        
        // Hotel form submit handler
        document.getElementById('hotelForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            
            // Build name object
            const name = {
                ru: document.getElementById('hotelNameRu').value,
                en: document.getElementById('hotelNameEn').value,
                tj: document.getElementById('hotelNameTj').value
            };
            
            // Build description object
            const description = {
                ru: document.getElementById('hotelDescRu').value,
                en: document.getElementById('hotelDescEn').value,
                tj: document.getElementById('hotelDescTj').value
            };
            
            // Get amenities
            const amenities = [];
            document.querySelectorAll('#hotelForm input[type="checkbox"]:checked').forEach(checkbox => {
                if (checkbox.id !== 'hotelActive') {
                    amenities.push(checkbox.value);
                }
            });
            
            // Build hotel data
            const hotelData = {
                name: JSON.stringify(name),
                description: JSON.stringify(description),
                address: document.getElementById('hotelAddress').value,
                rating: parseFloat(document.getElementById('hotelRating').value) || null,
                pension: document.getElementById('hotelPension').value,
                amenities: JSON.stringify(amenities),
                isActive: document.getElementById('hotelActive').checked,
                images: JSON.stringify([]) // For now, we'll handle images separately
            };
            
            // Append hotel data to formData
            Object.keys(hotelData).forEach(key => {
                formData.append(key, hotelData[key]);
            });
            
            // Handle images
            const imageFiles = document.getElementById('hotelImages').files;
            for (let i = 0; i < imageFiles.length; i++) {
                formData.append('images', imageFiles[i]);
            }
            
            const apiUrl = getApiUrl();
            const url = currentHotelId ? `${apiUrl}/hotels/${currentHotelId}` : `${apiUrl}/hotels`;
            const method = currentHotelId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: formData
            })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert(currentHotelId ? 'Отель успешно обновлен' : 'Отель успешно создан');
                        closeHotelModal();
                        loadHotels();
                    } else {
                        alert('Ошибка: ' + (data.message || 'Неизвестная ошибка'));
                    }
                })
                .catch(err => {
                    console.error('Error saving hotel:', err);
                    alert('Ошибка при сохранении отеля');
                });
        });
        
        // Hotel image preview handler
        document.getElementById('hotelImages').addEventListener('change', function(e) {
            const files = e.target.files;
            const preview = document.getElementById('hotelImagePreview');
            preview.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.classList.add('image-preview');
                    preview.appendChild(img);
                };
                
                reader.readAsDataURL(file);
            }
        });

        // Bookings functions
        function loadBookings(status = 'all') {
            let url = 'http://localhost:3001/api/orders';
            if (status !== 'all') {
                url += `?status=${status}`;
            }
            
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('bookingsTable');
                    if (!data.orders || data.orders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="10" class="text-center text-gray-500">Нет заказов</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = data.orders.map(order => `
                        <tr>
                            <td class="font-medium">${order.orderNumber || 'N/A'}</td>
                            <td>${formatDate(order.createdAt)}</td>
                            <td>${order.customer?.fullName || 'Неизвестно'}</td>
                            <td>${getTourName(order.tour)}</td>
                            <td>${order.tourDate || '-'}</td>
                            <td>${JSON.parse(order.tourists || '[]').length} чел.</td>
                            <td class="font-semibold">$${order.totalAmount}</td>
                            <td>${getPaymentBadge(order.paymentStatus)}</td>
                            <td>${getStatusBadge(order.status)}</td>
                            <td>
                                <button onclick="viewBooking(${order.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `).join('');
                })
                .catch(err => {
                    console.error('Error loading bookings:', err);
                });
        }
        
        function viewBooking(bookingId) {
            currentBookingId = bookingId;
            document.getElementById('bookingModal').classList.add('active');
            
            fetch(`http://localhost:3001/api/orders/${bookingId}`)
                .then(res => res.json())
                .then(data => {
                    const order = data.order;
                    const tourists = JSON.parse(order.tourists || '[]');
                    
                    document.getElementById('bookingDetails').innerHTML = `
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Номер заказа</p>
                                    <p class="font-semibold">${order.orderNumber}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Дата заказа</p>
                                    <p class="font-semibold">${formatDate(order.createdAt)}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Клиент</p>
                                    <p class="font-semibold">${order.customer?.fullName}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Email</p>
                                    <p class="font-semibold">${order.customer?.email}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Тур</p>
                                    <p class="font-semibold">${getTourName(order.tour)}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Дата тура</p>
                                    <p class="font-semibold">${order.tourDate}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Отель</p>
                                    <p class="font-semibold">${order.hotel ? getHotelName(order.hotel) : 'Не выбран'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Гид</p>
                                    <p class="font-semibold">${order.guide ? getGuideName(order.guide) : 'Не выбран'}</p>
                                </div>
                            </div>
                            
                            <div>
                                <p class="text-sm text-gray-600 mb-2">Список туристов</p>
                                <div class="bg-gray-50 p-3 rounded">
                                    ${tourists.map((t, i) => `
                                        <div class="mb-2">
                                            ${i + 1}. ${t.fullName} (${t.birthDate})
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            ${order.wishes ? `
                                <div>
                                    <p class="text-sm text-gray-600 mb-2">Пожелания клиента</p>
                                    <div class="bg-gray-50 p-3 rounded">
                                        ${order.wishes}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="flex justify-between items-center pt-4 border-t">
                                <div>
                                    <p class="text-sm text-gray-600">Общая сумма</p>
                                    <p class="text-2xl font-bold text-green-600">$${order.totalAmount}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm text-gray-600">Статус</p>
                                    <p>${getStatusBadge(order.status)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
        }
        
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
            currentBookingId = null;
        }
        
        // Hotels functions
        function loadHotels() {
            fetch('http://localhost:3001/api/hotels')
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('hotelsList');
                    
                    if (!data.hotels || data.hotels.length === 0) {
                        container.innerHTML = '<p class="text-gray-500">Нет отелей</p>';
                        return;
                    }
                    
                    container.innerHTML = data.hotels.map(hotel => {
                        const name = JSON.parse(hotel.name || '{}');
                        const description = JSON.parse(hotel.description || '{}');
                        const images = JSON.parse(hotel.images || '[]');
                        
                        return `
                            <div class="bg-white rounded-lg shadow-sm p-4">
                                ${images[0] ? `<img src="${images[0]}" alt="${name.ru}" class="w-full h-48 object-cover rounded-lg mb-4">` : ''}
                                <h3 class="font-semibold text-lg mb-2">${name.ru || name.en || 'Отель'}</h3>
                                <p class="text-gray-600 text-sm mb-3">${(description.ru || description.en || '').substring(0, 100)}...</p>
                                <div class="flex items-center justify-between">
                                    <span class="text-yellow-500">
                                        ${'★'.repeat(Math.floor(hotel.rating || 4))}${'☆'.repeat(5 - Math.floor(hotel.rating || 4))}
                                    </span>
                                    <div>
                                        <button onclick="editHotel(${hotel.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteHotel(${hotel.id})" class="text-red-600 hover:text-red-800">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                });
        }
        
        // Guides functions
        function loadGuides() {
            fetch('http://localhost:3001/api/guides')
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('guidesList');
                    
                    if (!data.guides || data.guides.length === 0) {
                        container.innerHTML = '<p class="text-gray-500">Нет гидов</p>';
                        return;
                    }
                    
                    container.innerHTML = data.guides.map(guide => {
                        const name = JSON.parse(guide.name || '{}');
                        const languages = JSON.parse(guide.languages || '[]');
                        
                        return `
                            <div class="bg-white rounded-lg shadow-sm p-4">
                                <div class="flex items-center mb-4">
                                    ${guide.photo ? 
                                        `<img src="${guide.photo}" alt="${name.ru}" class="w-16 h-16 rounded-full object-cover mr-4">` :
                                        `<div class="w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center mr-4">
                                            <i class="fas fa-user text-gray-400 text-2xl"></i>
                                        </div>`
                                    }
                                    <div>
                                        <h3 class="font-semibold text-lg">${name.ru || name.en || 'Гид'}</h3>
                                        <p class="text-sm text-gray-600">${guide.experience || 0} лет опыта</p>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-sm text-gray-600 mb-1">Языки:</p>
                                    <div class="flex flex-wrap gap-1">
                                        ${languages.map(lang => `
                                            <span class="badge badge-info text-xs">${lang}</span>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-yellow-500">
                                        ${'★'.repeat(Math.floor(guide.rating || 5))}${'☆'.repeat(5 - Math.floor(guide.rating || 5))}
                                    </span>
                                    <div>
                                        <button onclick="editGuide(${guide.id})" class="text-blue-600 hover:text-blue-800 mr-2">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteGuide(${guide.id})" class="text-red-600 hover:text-red-800">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                });
        }
        
        // Reviews functions
        function loadReviews(filter = 'all') {
            fetch('http://localhost:3001/api/reviews')
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById('reviewsTable');
                    let reviews = data.reviews || [];
                    
                    // Filter reviews
                    if (filter === 'pending') {
                        reviews = reviews.filter(r => !r.isModerated);
                    } else if (filter === 'approved') {
                        reviews = reviews.filter(r => r.isApproved);
                    } else if (filter === 'rejected') {
                        reviews = reviews.filter(r => r.isModerated && !r.isApproved);
                    }
                    
                    if (reviews.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" class="text-center text-gray-500">Нет отзывов</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = reviews.map(review => `
                        <tr>
                            <td>${review.id}</td>
                            <td>${formatDate(review.createdAt)}</td>
                            <td>${review.customer?.fullName || 'Неизвестно'}</td>
                            <td>${getTourName(review.tour)}</td>
                            <td>
                                <span class="text-yellow-500">
                                    ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                                </span>
                            </td>
                            <td class="max-w-xs truncate">${review.text}</td>
                            <td>
                                ${!review.isModerated ? 
                                    '<span class="badge badge-warning">На модерации</span>' :
                                    review.isApproved ?
                                        '<span class="badge badge-success">Одобрен</span>' :
                                        '<span class="badge badge-danger">Отклонен</span>'
                                }
                            </td>
                            <td>
                                ${!review.isModerated ? `
                                    <button onclick="approveReview(${review.id})" class="text-green-600 hover:text-green-800 mr-2">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button onclick="rejectReview(${review.id})" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-times"></i>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `).join('');
                });
        }
        
        // Helper functions
        function getTourName(tour) {
            if (!tour) return 'Неизвестно';
            const title = JSON.parse(tour.title || '{}');
            return title.ru || title.en || 'Без названия';
        }
        
        function getHotelName(hotel) {
            if (!hotel) return 'Неизвестно';
            const name = JSON.parse(hotel.name || '{}');
            return name.ru || name.en || 'Отель';
        }
        
        function getGuideName(guide) {
            if (!guide) return 'Неизвестно';
            const name = JSON.parse(guide.name || '{}');
            return name.ru || name.en || 'Гид';
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }
        
        function getStatusBadge(status) {
            const badges = {
                pending: '<span class="badge badge-warning">Ожидает</span>',
                confirmed: '<span class="badge badge-info">Подтвержден</span>',
                paid: '<span class="badge badge-success">Оплачен</span>',
                completed: '<span class="badge badge-success">Завершен</span>',
                cancelled: '<span class="badge badge-danger">Отменен</span>'
            };
            return badges[status] || '<span class="badge">Неизвестно</span>';
        }
        
        function getPaymentBadge(status) {
            const badges = {
                unpaid: '<span class="badge badge-warning">Не оплачен</span>',
                paid: '<span class="badge badge-success">Оплачен</span>',
                refunded: '<span class="badge badge-danger">Возврат</span>'
            };
            return badges[status] || '<span class="badge">Неизвестно</span>';
        }
        
        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const parent = this.parentElement;
                parent.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                const status = this.dataset.status;
                const filter = this.dataset.filter;
                
                if (status) {
                    loadBookings(status);
                } else if (filter) {
                    loadReviews(filter);
                }
            });
        });
        
        // Form submissions
        document.getElementById('tourForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: JSON.stringify({
                    ru: document.getElementById('tourTitleRu').value,
                    en: document.getElementById('tourTitleEn').value
                }),
                description: JSON.stringify({
                    ru: document.getElementById('tourDescRu').value,
                    en: document.getElementById('tourDescEn').value
                }),
                categoryId: parseInt(document.getElementById('tourCategory').value),
                tourBlockId: document.getElementById('tourBlockId') ? parseInt(document.getElementById('tourBlockId').value) : null,
                country: document.getElementById('tourCountry').value,
                city: document.getElementById('tourCity').value,
                duration: document.getElementById('tourDuration').value,
                durationDays: parseInt(document.getElementById('tourDurationDays').value),
                format: document.getElementById('tourFormat').value,
                price: document.getElementById('tourPrice').value,
                priceType: document.getElementById('tourPriceType').value,
                mealsIncluded: document.getElementById('tourMealsIncluded').value === 'true',
                languages: JSON.stringify(document.getElementById('tourLanguages').value.split(',').map(l => l.trim()).filter(l => l)),
                startDate: document.getElementById('tourStartDate').value,
                endDate: document.getElementById('tourEndDate').value
            };
            
            const url = currentTourId ? 
                `${getApiUrl()}/tours/${currentTourId}` : 
                `${getApiUrl()}/tours`;
            const method = currentTourId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Тур успешно сохранен!');
                    closeTourModal();
                    loadTours();
                } else {
                    alert('Ошибка при сохранении тура');
                }
            })
            .catch(err => {
                console.error('Error saving tour:', err);
                alert('Ошибка при сохранении тура');
            });
        });
        
        // Additional functions
        function editTour(id) {
            openTourModal(id);
        }
        
        function deleteTour(id) {
            if (confirm('Вы уверены, что хотите удалить этот тур?')) {
                fetch(`${getApiUrl()}/tours/${id}`, {
                    method: 'DELETE'
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Тур успешно удален');
                        loadTours();
                    }
                });
            }
        }
        
        function confirmBooking() {
            if (currentBookingId) {
                fetch(`${getApiUrl()}/orders/${currentBookingId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'confirmed' })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Заказ подтвержден');
                        closeBookingModal();
                        loadBookings();
                    }
                });
            }
        }
        
        function cancelBooking() {
            if (currentBookingId && confirm('Вы уверены, что хотите отменить этот заказ?')) {
                fetch(`${getApiUrl()}/orders/${currentBookingId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'cancelled' })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Заказ отменен');
                        closeBookingModal();
                        loadBookings();
                    }
                });
            }
        }
        
        function approveReview(id) {
            fetch(`${getApiUrl()}/reviews/${id}/moderate`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ isApproved: true })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Отзыв одобрен');
                    loadReviews();
                }
            });
        }
        
        function rejectReview(id) {
            fetch(`${getApiUrl()}/reviews/${id}/moderate`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ isApproved: false })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Отзыв отклонен');
                    loadReviews();
                }
            });
        }
        
        function openGuideModal() {
            const modal = `
                <div id="guideModal" class="modal active">
                    <div class="modal-content" style="width: 600px;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-semibold">Добавить гида</h2>
                            <button onclick="closeGuideModal()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        
                        <form id="guideForm">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="form-group">
                                    <label class="form-label">Имя (Русский)</label>
                                    <input type="text" class="form-input" id="guideNameRu" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Имя (English)</label>
                                    <input type="text" class="form-input" id="guideNameEn" required>
                                </div>
                                <div class="form-group col-span-2">
                                    <label class="form-label">Описание (Русский)</label>
                                    <textarea class="form-input" rows="3" id="guideDescRu"></textarea>
                                </div>
                                <div class="form-group col-span-2">
                                    <label class="form-label">Описание (English)</label>
                                    <textarea class="form-input" rows="3" id="guideDescEn"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Языки</label>
                                    <input type="text" class="form-input" id="guideLanguages" placeholder="Русский, English, Тоҷикӣ">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Опыт работы (лет)</label>
                                    <input type="number" class="form-input" id="guideExperience" min="0">
                                </div>
                                <div class="form-group col-span-2">
                                    <label class="form-label">Контакты</label>
                                    <input type="text" class="form-input" id="guideContact" placeholder="Телефон, Email">
                                </div>
                            </div>
                            
                            <div class="flex justify-end gap-3 mt-6">
                                <button type="button" onclick="closeGuideModal()" class="btn btn-secondary">Отмена</button>
                                <button type="submit" class="btn btn-primary">Сохранить</button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
            
            document.getElementById('guideForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveGuide();
            });
        }
        
        function closeGuideModal() {
            const modal = document.getElementById('guideModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function saveGuide() {
            const formData = {
                name: JSON.stringify({
                    ru: document.getElementById('guideNameRu').value,
                    en: document.getElementById('guideNameEn').value
                }),
                description: JSON.stringify({
                    ru: document.getElementById('guideDescRu').value,
                    en: document.getElementById('guideDescEn').value
                }),
                languages: document.getElementById('guideLanguages').value.split(',').map(l => l.trim()).filter(l => l),
                experience: parseInt(document.getElementById('guideExperience').value) || 0,
                contact: document.getElementById('guideContact').value,
                isActive: true
            };
            
            fetch(`${getApiUrl()}/guides`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Гид успешно создан!');
                    closeGuideModal();
                    loadGuides();
                } else {
                    alert('Ошибка при создании гида: ' + (data.message || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Error saving guide:', err);
                alert('Ошибка при сохранении гида');
            });
        }
        
        function editGuide(id) {
            alert('Редактирование гида будет добавлено в следующем обновлении');
        }
        
        function deleteGuide(id) {
            if (confirm('Вы уверены, что хотите удалить этого гида?')) {
                fetch(`${getApiUrl()}/guides/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Гид успешно удален');
                        loadGuides();
                    } else {
                        alert('Ошибка при удалении гида: ' + (data.message || 'Неизвестная ошибка'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting guide:', err);
                    alert('Ошибка при удалении гида');
                });
            }
        }

        // =============================================
        // CMS FUNCTIONS
        // =============================================
        
        // CMS Tab switching
        function switchCMSTab(tab) {
            // Hide all CMS tabs
            document.getElementById('cmsBlocksTab').style.display = 'none';
            document.getElementById('cmsSettingsTab').style.display = 'none';
            document.getElementById('cmsHomepageTab').style.display = 'none';
            
            // Show selected tab
            document.getElementById(`cms${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).style.display = 'block';
            
            // Update tab buttons
            document.querySelectorAll('#cmsSection .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load data for the selected tab
            switch(tab) {
                case 'blocks':
                    loadCMSContentBlocks();
                    break;
                case 'settings':
                    loadCMSSettings();
                    break;
                case 'homepage':
                    loadCMSHomepageContent();
                    break;
            }
        }
        
        // Load CMS Content Blocks
        function loadCMSContentBlocks() {
            console.log('Loading CMS content blocks...');
            fetch(`${getApiUrl()}/cms/content-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                console.log('CMS Content blocks response:', data);
                const tbody = document.getElementById('contentBlocksTable');
                
                if (!data.success || !data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500">Нет блоков контента</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.data.map(block => {
                    const title = JSON.parse(block.title || '{}');
                    return `
                        <tr>
                            <td class="font-medium">${block.id}</td>
                            <td>${block.type}</td>
                            <td>${title.ru || 'Не указано'}</td>
                            <td>${title.en || 'Не указано'}</td>
                            <td>${block.isActive ? '<span class="badge badge-success">Активен</span>' : '<span class="badge badge-warning">Неактивен</span>'}</td>
                            <td>${formatDate(block.updatedAt)}</td>
                            <td class="flex gap-2">
                                <button onclick="editContentBlock(${block.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteContentBlock(${block.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Error loading content blocks:', err);
                const tbody = document.getElementById('contentBlocksTable');
                tbody.innerHTML = '<tr><td colspan="7" class="text-center text-red-500">Ошибка загрузки данных</td></tr>';
            });
        }
        
        // Open Content Block Modal
        function openContentBlockModal(id = null) {
            currentContentBlockId = id;
            const modal = document.getElementById('contentBlockModal');
            const title = document.getElementById('contentBlockModalTitle');
            
            if (id) {
                title.textContent = 'Редактировать блок контента';
                loadContentBlockData(id);
            } else {
                title.textContent = 'Добавить блок контента';
                document.getElementById('contentBlockForm').reset();
            }
            
            modal.classList.add('active');
        }
        
        // Close Content Block Modal
        function closeContentBlockModal() {
            document.getElementById('contentBlockModal').classList.remove('active');
            currentContentBlockId = null;
        }
        
        // Load Content Block Data for editing
        function loadContentBlockData(id) {
            fetch(`${getApiUrl()}/cms/content-blocks/${id}`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const block = data.data;
                    const title = JSON.parse(block.title || '{}');
                    const content = JSON.parse(block.content || '{}');
                    
                    document.getElementById('blockType').value = block.type;
                    document.getElementById('blockOrder').value = block.sortOrder;
                    document.getElementById('blockActive').checked = block.isActive;
                    
                    // Fill multilingual fields
                    ['ru', 'en', 'tj', 'fa', 'de', 'zh'].forEach(lang => {
                        const titleField = document.getElementById(`blockTitle_${lang}`);
                        const contentField = document.getElementById(`blockContent_${lang}`);
                        if (titleField) titleField.value = title[lang] || '';
                        if (contentField) contentField.value = content[lang] || '';
                    });
                }
            })
            .catch(err => {
                console.error('Error loading content block:', err);
                alert('Ошибка загрузки блока');
            });
        }
        
        // Save Content Block
        document.getElementById('contentBlockForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = {};
            const content = {};
            
            ['ru', 'en', 'tj', 'fa', 'de', 'zh'].forEach(lang => {
                const titleField = document.getElementById(`blockTitle_${lang}`);
                const contentField = document.getElementById(`blockContent_${lang}`);
                if (titleField) title[lang] = titleField.value;
                if (contentField) content[lang] = contentField.value;
            });
            
            const formData = {
                type: document.getElementById('blockType').value,
                title: JSON.stringify(title),
                content: JSON.stringify(content),
                sortOrder: parseInt(document.getElementById('blockOrder').value),
                isActive: document.getElementById('blockActive').checked
            };
            
            const url = currentContentBlockId ? 
                `${getApiUrl()}/cms/content-blocks/${currentContentBlockId}` : 
                `${getApiUrl()}/cms/content-blocks`;
            const method = currentContentBlockId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Блок контента успешно сохранен!');
                    closeContentBlockModal();
                    loadCMSContentBlocks();
                } else {
                    alert('Ошибка при сохранении: ' + (data.message || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Error saving content block:', err);
                alert('Ошибка соединения с сервером');
            });
        });
        
        // Edit Content Block
        function editContentBlock(id) {
            openContentBlockModal(id);
        }
        
        // Delete Content Block
        function deleteContentBlock(id) {
            if (confirm('Вы уверены, что хотите удалить этот блок контента?')) {
                fetch(`${getApiUrl()}/cms/content-blocks/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Блок контента удален');
                        loadCMSContentBlocks();
                    } else {
                        alert('Ошибка при удалении: ' + (data.message || 'Неизвестная ошибка'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting content block:', err);
                    alert('Ошибка соединения с сервером');
                });
            }
        }
        
        // Load CMS Settings
        function loadCMSSettings() {
            fetch(`${getApiUrl()}/cms/settings`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const settings = data.data;
                    const siteTitle = JSON.parse(settings.siteTitle || '{}');
                    const siteDescription = JSON.parse(settings.siteDescription || '{}');
                    
                    document.getElementById('siteTitle_ru').value = siteTitle.ru || '';
                    document.getElementById('siteTitle_en').value = siteTitle.en || '';
                    document.getElementById('siteDescription_ru').value = siteDescription.ru || '';
                    document.getElementById('siteDescription_en').value = siteDescription.en || '';
                    document.getElementById('contactEmail').value = settings.contactEmail || '';
                    document.getElementById('contactPhone').value = settings.contactPhone || '';
                }
            })
            .catch(err => {
                console.error('Error loading CMS settings:', err);
            });
        }
        
        // Save CMS Settings
        document.getElementById('siteSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                siteTitle: JSON.stringify({
                    ru: document.getElementById('siteTitle_ru').value,
                    en: document.getElementById('siteTitle_en').value
                }),
                siteDescription: JSON.stringify({
                    ru: document.getElementById('siteDescription_ru').value,
                    en: document.getElementById('siteDescription_en').value
                }),
                contactEmail: document.getElementById('contactEmail').value,
                contactPhone: document.getElementById('contactPhone').value
            };
            
            fetch(`${getApiUrl()}/cms/settings`, {
                method: 'PUT',
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Настройки сайта успешно сохранены!');
                } else {
                    alert('Ошибка при сохранении настроек: ' + (data.message || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Error saving settings:', err);
                alert('Ошибка соединения с сервером');
            });
        });
        
        // Load CMS Homepage Content
        function loadCMSHomepageContent() {
            fetch(`${getApiUrl()}/public/homepage?lang=ru`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('homepageContentList');
                
                if (!data.success || !data.data) {
                    container.innerHTML = '<div class="text-center text-gray-500">Нет контента для главной страницы</div>';
                    return;
                }
                
                const { settings, contentBlocks } = data.data;
                
                let html = '<div class="bg-white rounded-xl shadow-sm p-6 mb-4">';
                html += '<h3 class="text-lg font-semibold mb-2">Настройки сайта</h3>';
                html += `<p><strong>Название сайта:</strong> ${settings.siteTitle || 'Не указано'}</p>`;
                html += `<p><strong>Описание:</strong> ${settings.siteDescription || 'Не указано'}</p>`;
                html += `<p><strong>Email:</strong> ${settings.contactEmail || 'Не указано'}</p>`;
                html += `<p><strong>Телефон:</strong> ${settings.contactPhone || 'Не указано'}</p>`;
                html += '</div>';
                
                if (contentBlocks.length > 0) {
                    html += '<div class="bg-white rounded-xl shadow-sm p-6">';
                    html += '<h3 class="text-lg font-semibold mb-4">Активные блоки контента</h3>';
                    contentBlocks.forEach(block => {
                        html += `
                            <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-medium">${block.title || 'Без названия'}</h4>
                                        <p class="text-sm text-gray-600">${block.type}</p>
                                        <p class="text-sm text-gray-500 mt-2">${(block.content || '').substring(0, 150)}...</p>
                                    </div>
                                    <button onclick="editContentBlock(${block.id})" class="btn btn-primary btn-sm">
                                        Редактировать
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                container.innerHTML = html;
            })
            .catch(err => {
                console.error('Error loading homepage content:', err);
                const container = document.getElementById('homepageContentList');
                container.innerHTML = '<div class="text-center text-red-500">Ошибка загрузки контента</div>';
            });
        }

        // Tour Blocks Management Functions
        function switchCMSTab(tab) {
            // Hide all tabs
            document.getElementById('cmsBlocksTab').style.display = 'none';
            document.getElementById('cmsSettingsTab').style.display = 'none';
            document.getElementById('cmsToursTab').style.display = 'none';
            
            // Remove active class from all tab buttons
            document.querySelectorAll('#cmsSection .tab-button').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab and add active class
            if (tab === 'blocks') {
                document.getElementById('cmsBlocksTab').style.display = 'block';
                document.querySelector('#cmsSection .tab-button:nth-child(1)').classList.add('active');
                loadTourBlocks();
            } else if (tab === 'settings') {
                document.getElementById('cmsSettingsTab').style.display = 'block';
                document.querySelector('#cmsSection .tab-button:nth-child(2)').classList.add('active');
                loadCMSSettings();
            } else if (tab === 'tours') {
                document.getElementById('cmsToursTab').style.display = 'block';
                document.querySelector('#cmsSection .tab-button:nth-child(3)').classList.add('active');
                loadEnhancedTourForm();
            }
        }

        // Load Tour Blocks
        function loadTourBlocks() {
            fetch(`${getApiUrl()}/tour-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('tourBlocksTable');
                
                if (!data.success || !data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" class="text-center text-gray-500">Нет блоков туров</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.data.map(block => {
                    const title = typeof block.title === 'string' ? JSON.parse(block.title || '{}') : block.title || {};
                    const toursCount = block.tours ? block.tours.length : 0;
                    return `
                        <tr>
                            <td class="font-medium">${block.id}</td>
                            <td>${title.ru || 'Не указано'}</td>
                            <td>${title.en || 'Не указано'}</td>
                            <td><code class="bg-gray-100 px-2 py-1 rounded text-sm">${block.slug}</code></td>
                            <td>${toursCount} туров</td>
                            <td>${block.isActive ? '<span class="badge badge-success">Активен</span>' : '<span class="badge badge-warning">Неактивен</span>'}</td>
                            <td>${block.sortOrder}</td>
                            <td class="flex gap-2">
                                <button onclick="editTourBlock(${block.id})" class="text-blue-600 hover:text-blue-800" title="Редактировать">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="manageTourBlockTours(${block.id})" class="text-green-600 hover:text-green-800" title="Управлять турами">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button onclick="deleteTourBlock(${block.id})" class="text-red-600 hover:text-red-800" title="Удалить">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            })
            .catch(err => {
                console.error('Error loading tour blocks:', err);
                const tbody = document.getElementById('tourBlocksTable');
                tbody.innerHTML = '<tr><td colspan="8" class="text-center text-red-500">Ошибка загрузки данных</td></tr>';
            });
        }

        // Global variables for modal handling
        let currentTourBlockId = null;

        // Open Tour Block Modal
        function openTourBlockModal(id = null) {
            currentTourBlockId = id;
            
            // Create modal HTML if it doesn't exist
            let modal = document.getElementById('tourBlockModal');
            if (!modal) {
                const modalHTML = `
                    <div id="tourBlockModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2 id="tourBlockModalTitle">Создать блок туров</h2>
                                <button onclick="closeTourBlockModal()" class="modal-close">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form id="tourBlockForm">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div class="form-group">
                                            <label class="form-label">Название блока (RU)</label>
                                            <input type="text" class="form-input" id="blockTitleRu" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Название блока (EN)</label>
                                            <input type="text" class="form-input" id="blockTitleEn" required>
                                        </div>
                                        <div class="form-group lg:col-span-2">
                                            <label class="form-label">Описание блока (RU)</label>
                                            <textarea class="form-input" id="blockDescRu" rows="3"></textarea>
                                        </div>
                                        <div class="form-group lg:col-span-2">
                                            <label class="form-label">Описание блока (EN)</label>
                                            <textarea class="form-input" id="blockDescEn" rows="3"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Слаг (URL)</label>
                                            <input type="text" class="form-input" id="blockSlug" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Порядок сортировки</label>
                                            <input type="number" class="form-input" id="blockSortOrder" value="0">
                                        </div>
                                        <div class="form-group lg:col-span-2">
                                            <label class="form-label flex items-center">
                                                <input type="checkbox" id="blockIsActive" class="mr-2" checked>
                                                Активный блок
                                            </label>
                                        </div>
                                    </div>
                                    <div class="mt-6 flex gap-2">
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i>
                                            Сохранить
                                        </button>
                                        <button type="button" onclick="closeTourBlockModal()" class="btn btn-secondary">
                                            Отмена
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHTML);
                modal = document.getElementById('tourBlockModal');
            }
            
            const title = document.getElementById('tourBlockModalTitle');
            
            if (id) {
                title.textContent = 'Редактировать блок туров';
                loadTourBlockData(id);
            } else {
                title.textContent = 'Создать блок туров';
                document.getElementById('tourBlockForm').reset();
                document.getElementById('blockIsActive').checked = true;
            }
            
            modal.classList.add('active');
        }

        // Close Tour Block Modal
        function closeTourBlockModal() {
            const modal = document.getElementById('tourBlockModal');
            if (modal) {
                modal.classList.remove('active');
            }
            currentTourBlockId = null;
        }

        // Load Tour Block Data for editing
        function loadTourBlockData(id) {
            fetch(`${getApiUrl()}/tour-blocks/${id}`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const block = data.data;
                    const title = JSON.parse(block.title || '{}');
                    const description = JSON.parse(block.description || '{}');
                    
                    document.getElementById('blockTitleRu').value = title.ru || '';
                    document.getElementById('blockTitleEn').value = title.en || '';
                    document.getElementById('blockDescRu').value = description.ru || '';
                    document.getElementById('blockDescEn').value = description.en || '';
                    document.getElementById('blockSlug').value = block.slug || '';
                    document.getElementById('blockSortOrder').value = block.sortOrder || 0;
                    document.getElementById('blockIsActive').checked = block.isActive;
                }
            })
            .catch(err => {
                console.error('Error loading tour block:', err);
                alert('Ошибка загрузки блока');
            });
        }

        // Initialize form handlers when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Tour Block Form Handler
            setTimeout(() => {
                const form = document.getElementById('tourBlockForm');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveTourBlock();
                    });
                }
            }, 100);
        });

        // Save Tour Block
        function saveTourBlock() {
            const formData = {
                title: JSON.stringify({
                    ru: document.getElementById('blockTitleRu').value,
                    en: document.getElementById('blockTitleEn').value
                }),
                description: JSON.stringify({
                    ru: document.getElementById('blockDescRu').value,
                    en: document.getElementById('blockDescEn').value
                }),
                slug: document.getElementById('blockSlug').value,
                sortOrder: parseInt(document.getElementById('blockSortOrder').value) || 0,
                isActive: document.getElementById('blockIsActive').checked
            };
            
            const url = currentTourBlockId ? 
                `${getApiUrl()}/tour-blocks/${currentTourBlockId}` : 
                `${getApiUrl()}/tour-blocks`;
            const method = currentTourBlockId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Блок туров успешно сохранен!');
                    closeTourBlockModal();
                    loadTourBlocks();
                } else {
                    alert('Ошибка при сохранении: ' + (data.message || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Error saving tour block:', err);
                alert('Ошибка соединения с сервером');
            });
        }

        // Edit Tour Block
        function editTourBlock(id) {
            openTourBlockModal(id);
        }

        // Delete Tour Block
        function deleteTourBlock(id) {
            if (confirm('Вы уверены, что хотите удалить этот блок туров? Все туры из блока останутся, но будут не привязаны к блоку.')) {
                fetch(`${getApiUrl()}/tour-blocks/${id}`, {
                    method: 'DELETE',
                    headers: getAuthHeaders()
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        alert('Блок туров удален');
                        loadTourBlocks();
                    } else {
                        alert('Ошибка при удалении: ' + (data.message || 'Неизвестная ошибка'));
                    }
                })
                .catch(err => {
                    console.error('Error deleting tour block:', err);
                    alert('Ошибка соединения с сервером');
                });
            }
        }

        // Manage Tour Block Tours
        function manageTourBlockTours(blockId) {
            alert('Функция управления турами в блоке скоро будет реализована');
        }

        // Load Enhanced Tour Form
        function loadEnhancedTourForm() {
            // Load tour blocks for selection
            fetch(`${getApiUrl()}/tour-blocks`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('eTourBlockId');
                if (select && data.success && data.data) {
                    select.innerHTML = '<option value="">Выберите блок туров</option>' +
                        data.data.map(block => {
                            const title = JSON.parse(block.title || '{}');
                            return `<option value="${block.id}">${title.ru || title.en || `Блок ${block.id}`}</option>`;
                        }).join('');
                }
            })
            .catch(err => console.error('Error loading tour blocks for form:', err));

            // Load categories for selection
            loadCategories().then(categories => {
                const select = document.getElementById('eTourCategoryId');
                if (select && categories) {
                    select.innerHTML = '<option value="">Выберите категорию</option>' +
                        categories.map(cat => {
                            const title = JSON.parse(cat.title || '{}');
                            return `<option value="${cat.id}">${title.ru || title.en || cat.name}</option>`;
                        }).join('');
                }
            });
        }

        // Initialize Enhanced Tour Form Handler
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const form = document.getElementById('enhancedTourForm');
                if (form) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                        saveEnhancedTour();
                    });
                }
            }, 100);
        });

        // Save Enhanced Tour
        function saveEnhancedTour() {
            const formData = {
                title: JSON.stringify({
                    ru: document.getElementById('eTourTitleRu').value,
                    en: document.getElementById('eTourTitleEn').value
                }),
                shortDescription: JSON.stringify({
                    ru: document.getElementById('eTourShortDesc').value,
                    en: document.getElementById('eTourShortDesc').value
                }),
                description: JSON.stringify({
                    ru: document.getElementById('eTourFullDesc').value,
                    en: document.getElementById('eTourFullDesc').value
                }),
                price: parseFloat(document.getElementById('eTourPrice').value),
                priceType: document.getElementById('eTourPriceType').value,
                originalPrice: document.getElementById('eTourOriginalPrice').value ? parseFloat(document.getElementById('eTourOriginalPrice').value) : null,
                durationDays: parseInt(document.getElementById('eTourDurationDays').value),
                difficulty: document.getElementById('eTourDifficulty').value,
                maxPeople: document.getElementById('eTourMaxPeople').value ? parseInt(document.getElementById('eTourMaxPeople').value) : null,
                minPeople: document.getElementById('eTourMinPeople').value ? parseInt(document.getElementById('eTourMinPeople').value) : null,
                country: document.getElementById('eTourCountry').value,
                city: document.getElementById('eTourCity').value,
                mainImage: document.getElementById('eTourMainImage').value,
                images: JSON.stringify([document.getElementById('eTourMainImage').value].filter(Boolean)),
                categoryId: parseInt(document.getElementById('eTourCategoryId').value),
                tourBlockId: document.getElementById('eTourBlockId').value ? parseInt(document.getElementById('eTourBlockId').value) : null,
                isFeatured: document.getElementById('eTourIsFeatured').checked,
                isActive: true,
                highlights: JSON.stringify({ ru: "", en: "" }),
                itinerary: JSON.stringify({ ru: [], en: [] }),
                included: JSON.stringify({ ru: [], en: [] }),
                excluded: JSON.stringify({ ru: [], en: [] })
            };

            fetch(`${getApiUrl()}/tours`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Тур успешно создан!');
                    document.getElementById('enhancedTourForm').reset();
                    loadEnhancedTourForm(); // Reload form to refresh selects
                } else {
                    alert('Ошибка при создании тура: ' + (data.message || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Error saving tour:', err);
                alert('Ошибка соединения с сервером');
            });
        }

        // ===== TRANSLATION FUNCTIONALITY =====
        
        // Show translations section
        function showTranslations() {
            showSection('translations');
            loadTranslationData();
        }

        // Load translation-related data
        function loadTranslationData() {
            loadTourSelectOptions();
            loadTranslationStatistics();
        }

        // Load tour options for translation dropdown
        function loadTourSelectOptions() {
            fetch(`${getApiUrl()}/tours`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('translationTourSelect');
                if (select && data.success && data.data) {
                    select.innerHTML = '<option value="">-- Выберите тур --</option>' +
                        data.data.map(tour => {
                            const title = JSON.parse(tour.title || '{}');
                            return `<option value="${tour.id}">${title.ru || title.en || `Тур ${tour.id}`}</option>`;
                        }).join('');
                }
            })
            .catch(err => console.error('Error loading tours for translation:', err));
        }

        // Load translation statistics
        function loadTranslationStatistics() {
            fetch(`${getApiUrl()}/tours`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const tours = data.data;
                    let translatedCount = 0;
                    let pendingCount = 0;
                    
                    tours.forEach(tour => {
                        const title = JSON.parse(tour.title || '{}');
                        const description = JSON.parse(tour.description || '{}');
                        
                        // Check if all 6 languages are present
                        const supportedLanguages = ['ru', 'en', 'tj', 'fa', 'de', 'zh'];
                        const titleComplete = supportedLanguages.every(lang => title[lang] && title[lang].trim());
                        const descComplete = supportedLanguages.every(lang => description[lang] && description[lang].trim());
                        
                        if (titleComplete && descComplete) {
                            translatedCount++;
                        } else {
                            pendingCount++;
                        }
                    });
                    
                    document.getElementById('translatedToursCount').textContent = translatedCount;
                    document.getElementById('pendingTranslationsCount').textContent = pendingCount;
                }
            })
            .catch(err => console.error('Error loading translation statistics:', err));
        }

        // Single tour translation form handler
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const singleForm = document.getElementById('singleTranslationForm');
                if (singleForm) {
                    singleForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        translateSingleTour();
                    });
                }
                
                const manualForm = document.getElementById('manualTranslationForm');
                if (manualForm) {
                    manualForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        translateManualText();
                    });
                }
            }, 200);
        });

        // Translate single tour
        function translateSingleTour() {
            const tourId = document.getElementById('translationTourSelect').value;
            if (!tourId) {
                alert('Пожалуйста, выберите тур для перевода');
                return;
            }
            
            const btn = document.getElementById('translateSingleBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Переводится...';
            
            fetch(`${getApiUrl()}/translate/tour/${tourId}`, {
                method: 'POST',
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert('Тур успешно переведен на все языки!');
                    loadTranslationStatistics(); // Refresh stats
                } else {
                    alert('Ошибка перевода: ' + (data.error || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Translation error:', err);
                alert('Ошибка соединения с сервером');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // Batch translate all tours
        function batchTranslateAllTours() {
            if (!confirm('Это может занять несколько минут. Продолжить перевод всех туров?')) {
                return;
            }
            
            showTranslationProgress();
            
            fetch(`${getApiUrl()}/tours`, {
                headers: getAuthHeaders()
            })
            .then(res => res.json())
            .then(data => {
                if (data.success && data.data) {
                    const tourIds = data.data.map(tour => tour.id);
                    return batchTranslateTours(tourIds);
                } else {
                    throw new Error('Не удалось загрузить список туров');
                }
            })
            .catch(err => {
                console.error('Batch translation error:', err);
                alert('Ошибка: ' + err.message);
                hideTranslationProgress();
            });
        }

        // Batch translate selected tours
        function batchTranslateTours(tourIds) {
            return fetch(`${getApiUrl()}/translate/tours/batch`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify({ tourIds })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    updateProgressBar(100);
                    document.getElementById('progressText').textContent = 
                        `Завершено! ${data.data.successCount} туров переведено успешно, ${data.data.errorCount} ошибок`;
                    
                    // Show results
                    const results = document.getElementById('translationResults');
                    results.innerHTML = `
                        <div class="text-green-600 font-medium">✅ Успешно переведено: ${data.data.successCount} туров</div>
                        ${data.data.errors.length > 0 ? 
                            `<div class="text-red-600 font-medium">❌ Ошибки: ${data.data.errors.join(', ')}</div>` : ''
                        }
                    `;
                    
                    loadTranslationStatistics(); // Refresh stats
                    
                    setTimeout(() => {
                        hideTranslationProgress();
                    }, 5000);
                } else {
                    throw new Error(data.error || 'Batch translation failed');
                }
            })
            .catch(err => {
                console.error('Batch translation error:', err);
                alert('Ошибка массового перевода: ' + err.message);
                hideTranslationProgress();
            });
        }

        // Manual text translation
        function translateManualText() {
            const sourceText = document.getElementById('sourceText').value;
            const sourceLanguage = document.getElementById('sourceLanguage').value;
            const targetLanguage = document.getElementById('targetLanguage').value;
            
            if (!sourceText.trim()) {
                alert('Пожалуйста, введите текст для перевода');
                return;
            }
            
            if (sourceLanguage === targetLanguage) {
                alert('Исходный и целевой языки должны отличаться');
                return;
            }
            
            const btn = document.getElementById('manualTranslateBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Переводится...';
            
            fetch(`${getApiUrl()}/translate/text`, {
                method: 'POST',
                headers: getAuthHeaders(),
                body: JSON.stringify({
                    text: sourceText,
                    fromLanguage: sourceLanguage,
                    toLanguage: targetLanguage,
                    context: 'tour_description'
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('translatedText').value = data.data.translatedText;
                } else {
                    alert('Ошибка перевода: ' + (data.error || 'Неизвестная ошибка'));
                }
            })
            .catch(err => {
                console.error('Manual translation error:', err);
                alert('Ошибка соединения с сервером');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        }

        // Copy translation to clipboard
        function copyTranslation() {
            const text = document.getElementById('translatedText').value;
            if (!text) {
                alert('Нет текста для копирования');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Перевод скопирован в буфер обмена!');
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('Не удалось скопировать текст');
            });
        }

        // Show batch translation modal (placeholder)
        function showBatchTranslationModal() {
            alert('Функция выборочного перевода туров будет реализована в следующей версии');
        }

        // Show/hide translation progress
        function showTranslationProgress() {
            document.getElementById('translationProgress').style.display = 'block';
            updateProgressBar(0);
            document.getElementById('progressText').textContent = 'Подготовка к переводу...';
            document.getElementById('translationResults').innerHTML = '';
        }

        function hideTranslationProgress() {
            document.getElementById('translationProgress').style.display = 'none';
        }

        function updateProgressBar(percent) {
            document.getElementById('progressBar').style.width = percent + '%';
        }

        // Update navigation to handle translations section
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handler for translations navigation
            const navItems = document.querySelectorAll('[data-section="translations"]');
            navItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    showTranslations();
                });
            });
        });
    </script>
</body>
</html>